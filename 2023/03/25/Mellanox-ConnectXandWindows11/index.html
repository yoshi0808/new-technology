<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/new-technology/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/new-technology/images/icon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/new-technology/images/icon-16x16.png">
  <link rel="mask-icon" href="/new-technology/images/logo.svg" color="#222">

<link rel="stylesheet" href="/new-technology/css/main.css">



<link rel="stylesheet" href="/new-technology/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="/new-technology/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yoshi0808.github.io","root":"/new-technology/","images":"/new-technology/images","scheme":"Mist","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":false,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"検索…","empty":"検索結果が見つかりませんでした: ${query}","hits_time":"${hits} の結果が ${time} ms で見つかりました","hits":"${hits} 件の結果が見つかりました"},"path":"/new-technology/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/new-technology/js/config.js"></script>

    <meta name="description" content="この記事で実現すること  この記事ではSFP+のネットワークカードである、Mellanox Connect XについてWindows11の対応状況やWindowsでのファームウェアアップデートなどを記します。">
<meta property="og:type" content="article">
<meta property="og:title" content="Mellanox Connect XとWindows11">
<meta property="og:url" content="https://yoshi0808.github.io/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/index.html">
<meta property="og:site_name" content="New technologies in our life">
<meta property="og:description" content="この記事で実現すること  この記事ではSFP+のネットワークカードである、Mellanox Connect XについてWindows11の対応状況やWindowsでのファームウェアアップデートなどを記します。">
<meta property="og:locale" content="ja_JP">
<meta property="og:image" content="https://yoshi0808.github.io/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/title.png">
<meta property="og:image" content="https://yoshi0808.github.io/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/x3.png">
<meta property="og:image" content="https://yoshi0808.github.io/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/x4.png">
<meta property="og:image" content="https://yoshi0808.github.io/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/setup.png">
<meta property="og:image" content="https://yoshi0808.github.io/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/pci1.png">
<meta property="og:image" content="https://yoshi0808.github.io/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/pci2.png">
<meta property="og:image" content="https://yoshi0808.github.io/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/unifi1.png">
<meta property="og:image" content="https://yoshi0808.github.io/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/mellanox.png">
<meta property="article:published_time" content="2023-03-24T15:00:01.000Z">
<meta property="article:modified_time" content="2023-07-07T09:59:55.337Z">
<meta property="article:author" content="阿部　吉伸(Yoshinobu ABE)">
<meta property="article:tag" content="SFP+">
<meta property="article:tag" content="10GbE">
<meta property="article:tag" content="25GbE">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yoshi0808.github.io/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/title.png">


<link rel="canonical" href="https://yoshi0808.github.io/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"ja","comments":true,"permalink":"https://yoshi0808.github.io/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/","path":"2023/03/25/Mellanox-ConnectXandWindows11/","title":"Mellanox Connect XとWindows11"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Mellanox Connect XとWindows11 | New technologies in our life</title>
  



  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{&quot;token&quot;: &quot;0148b4d0442e42b483ddce684030bd2f&quot;}'></script>




<script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JMY6NSC2KK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('consent', 'default', {
  'ad_storage': 'denied',
  'analytics_storage': 'denied'
  });

  dataLayer.push({
  'event': 'default_consent'
  });

  if (Cookies.get('PRVCY202112') == 'Agree') {
    gtag('consent', 'update', {
    'analytics_storage': 'granted'
    });
  }

  gtag('js', new Date());
  gtag('config', 'G-JMY6NSC2KK',{ 'anonymize_ip': true });
</script>


  <noscript>
    <link rel="stylesheet" href="/new-technology/css/noscript.css">
  </noscript>
<link rel="alternate" href="/new-technology/atom.xml" title="New technologies in our life" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="ナビゲーションバーの切り替え" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/new-technology/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">New technologies in our life</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Device,Network,Code,etc...</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="検索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/new-technology/" rel="section"><i class="fa fa-home fa-fw"></i>ホーム</a></li><li class="menu-item menu-item-about"><a href="/new-technology/about/" rel="section"><i class="fa fa-user fa-fw"></i>サイトポリシー</a></li><li class="menu-item menu-item-tags"><a href="/new-technology/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>タグ</a></li><li class="menu-item menu-item-categories"><a href="/new-technology/categories/" rel="section"><i class="fa fa-th fa-fw"></i>カテゴリ</a></li><li class="menu-item menu-item-archives"><a href="/new-technology/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>アーカイブ</a></li><li class="menu-item menu-item-privacy"><a href="/new-technology/privacypolicy/" rel="section"><i class="fa fa-check fa-fw"></i>プライバシーポリシー</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>検索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="検索…" spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          見出し
        </li>
        <li class="sidebar-nav-overview">
          概要
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E4%BE%A1%E3%81%AAMellanox-Connect-X%E3%82%AB%E3%83%BC%E3%83%89"><span class="nav-number">1.</span> <span class="nav-text">安価なMellanox Connect-Xカード</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Windows11%E3%81%A7%E3%81%AE%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%83%89%E3%83%A9%E3%82%A4%E3%83%90"><span class="nav-number">2.</span> <span class="nav-text">Windows11でのデバイスドライバ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Connect-X-3"><span class="nav-number">2.1.</span> <span class="nav-text">Connect X-3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Connect-X-4"><span class="nav-number">2.2.</span> <span class="nav-text">Connect X-4</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Connect-X-4%E3%81%AE%E3%82%B9%E3%83%AB%E3%83%BC%E3%83%97%E3%83%83%E3%83%88"><span class="nav-number">3.</span> <span class="nav-text">Connect X-4のスループット</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Connect-X%E3%81%AE%E3%83%95%E3%82%A1%E3%83%BC%E3%83%A0%E3%82%A6%E3%82%A7%E3%82%A2%E6%9B%B4%E6%96%B0%EF%BC%88Windows%E7%89%88%EF%BC%89"><span class="nav-number">4.</span> <span class="nav-text">Connect Xのファームウェア更新（Windows版）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PCIe-x4%E3%82%B9%E3%83%AD%E3%83%83%E3%83%88"><span class="nav-number">5.</span> <span class="nav-text">PCIe x4スロット</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="阿部　吉伸(Yoshinobu ABE)"
      src="/new-technology/images/yoshi.png">
  <p class="site-author-name" itemprop="name">阿部　吉伸(Yoshinobu ABE)</p>
  <div class="site-description" itemprop="description">IT</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/new-technology/archives/">
          <span class="site-state-item-count">91</span>
          <span class="site-state-item-name">ポスト</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/new-technology/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">カテゴリ</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/new-technology/tags/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">タグ</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/yoshi0808" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yoshi0808" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yoshi0808.blog@gmail.com" title="E-Mail → mailto:yoshi0808.blog@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/yoshi0808_" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;yoshi0808_" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja" class="cc-opacity" rel="noopener" target="_blank"><img src="/new-technology/lib/@creativecommons/vocabulary/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="ja">
    <link itemprop="mainEntityOfPage" href="https://yoshi0808.github.io/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/new-technology/images/yoshi.png">
      <meta itemprop="name" content="阿部　吉伸(Yoshinobu ABE)">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="New technologies in our life">
      <meta itemprop="description" content="IT">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Mellanox Connect XとWindows11 | New technologies in our life">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Mellanox Connect XとWindows11
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">投稿日</span>

      <time title="作成日：2023-03-25 00:00:01" itemprop="dateCreated datePublished" datetime="2023-03-25T00:00:01+09:00">2023-03-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">編集日</span>
      <time title="修正日：2023-07-07 18:59:55" itemprop="dateModified" datetime="2023-07-07T18:59:55+09:00">2023-07-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">カテゴリ</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/new-technology/categories/Hardware/" itemprop="url" rel="index"><span itemprop="name">Hardware</span></a>
        </span>
          、
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/new-technology/categories/Network/" itemprop="url" rel="index"><span itemprop="name">Network</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><img src="/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/title.png" class="" width="1024" title="alt">
<p class="onepoint">この記事で実現すること</p>

<p>この記事ではSFP+のネットワークカードである、Mellanox Connect XについてWindows11の対応状況やWindowsでのファームウェアアップデートなどを記します。</p>
<span id="more"></span>

<h2 id="安価なMellanox-Connect-Xカード"><a href="#安価なMellanox-Connect-Xカード" class="headerlink" title="安価なMellanox Connect-Xカード"></a>安価なMellanox Connect-Xカード</h2><p>すでに販売終了となったConnect X-3はeBayで5,000円弱で売られています。MellanoxのConnect Xシリーズは脆弱性の指摘も見かけず、安定しているNICでしょうか。intelに比べればマイナーですが、SFP＋で安価に入手可能となっており、ホームユーザーにとっても大変ありがたい存在です。<br>Connect X-3はWindows10までのドライバはNvidiaのサイトに掲載されていますがWindows11ではドライバの存在はありません。</p>
<p>しかしながら、Windows11ではConnect Xを認識してWindowsとして用意されたドライバのインストールが行われ、すぐに使えます。いわゆる、Windows11に標準で付属しているinboxドライバになります。逆にNVidiaサイトにあるWindows10用のドライバはWindows11ではエラーが発生し動きません。後述のNVidiaフォーラムの投稿をご確認ください。</p>
<p>最近、2PortのMellanox Connect X-4 LxをeBayでちらほら見かけるようになってきました。販売終了した製品ですが、サポートはされています。</p>
<p><strong>MCX4121A-ACAT</strong>という型番は、<strong>Mellanox ConnectX-4 LX 25GBE SFP28 2ポートPCIeイーサネット アダプター</strong>となっており、eBayで15,000円ほどで購入できます。SFP28はSFP+とモジュール接続口の互換性があります。SFP＋のダイレクトアタッチケーブル（DAC）やOM3ケーブルと共に使うSFP+短距離マルチモードファイバ（MM SR）モジュール等の10GbE SFP+で問題なく10Gbps通信できます。もちろん25GbEとしても使えますが、PCなどホスト端末に挿して使うには他の機器との速度差が大きすぎて使いにくいものです。intel製のNICは在庫不足から回復傾向にあるようですが、まだまだ高額です。</p>
<p>詳しいスペックは以下のリンクを参照してください。PCIe3 x8となっています。</p>
<blockquote>
<p>Mellanox Connect X-4<br> <a target="_blank" rel="noopener" href="https://network.nvidia.com/files/doc-2020/pb-connectx-4-lx-en-card.pdf">https://network.nvidia.com/files/doc-2020/pb-connectx-4-lx-en-card.pdf</a></p>
</blockquote>
<p>Connect X-3はやや個人向けの色合いが強かったですが、Connect X-4あたりからはサーバー製品としての要素が強くなっていきます。OEM版（HPE、DELL向け等）は避けることをお勧めします。これはベンダーロックインが掛かっている可能性が高く、ファームウェアの強制書き込みなどが必要になります。また、それでうまくいく保証もありません。また、Connect X-4はいろいろなホストインタフェースがありますので、Ethernet、PCIeというところに気をつけてください。PCIeスロットに挿すだけですぐにWindows11で使えるMCX4121A-ACATはお勧めです。</p>
<p>2Portも要らないといっても、eBayでは意外と1Portものが出ていません。また、他カードとの兼ね合い（x16が埋まっている）でPCIe x4までという方は一般論としてConnect X-3（MCX311A-XCAT）が向いています。</p>
<blockquote>
<p>Nvidia ConnectX-4 Lx 製品概要<br> <a target="_blank" rel="noopener" href="https://www.nvidia.com/ja-jp/networking/ethernet/connectx-4-lx/">https://www.nvidia.com/ja-jp/networking/ethernet/connectx-4-lx/</a></p>
</blockquote>
<blockquote>
<p>NVidiaフォーラムでConnect X-3のWin11のドライバが無いことをNVidiaのテクニカルサポートが示唆<br> <a target="_blank" rel="noopener" href="https://forums.developer.nvidia.com/t/connectx-3-cx311a-xcat-for-win11-crashed/205962">https://forums.developer.nvidia.com/t/connectx-3-cx311a-xcat-for-win11-crashed/205962</a></p>
</blockquote>
<h2 id="Windows11でのデバイスドライバ"><a href="#Windows11でのデバイスドライバ" class="headerlink" title="Windows11でのデバイスドライバ"></a>Windows11でのデバイスドライバ</h2><h3 id="Connect-X-3"><a href="#Connect-X-3" class="headerlink" title="Connect X-3"></a>Connect X-3</h3><p>Connect X-3をPCIeにセットしてWin11を起動します。デバイスドライバを見てみます。</p>
<img src="/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/x3.png" class="" width="480" title="alt">

<p>2019年のinboxドライバが自動的に取り込まれます。このドライバに脆弱性が出てしまえば、リスクがあり別の製品に買い替えが必要となりますが、脆弱性データベースでもなかなかMellanoxの名前を見ることはありません。</p>
<p>お約束ですが、ESXi上のUbuntuとのiperf3を実行してみます。MTUは1,500のデフォルト、スイッチはフローコントロールをオンにしています。<br>多重度3でUbuntuからダウンロードする方向（-Rオプション）に実行して以下の通りです。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[ ID] Interval           Transfer     Bitrate         Retr</span><br><span class="line">[  5]   0.00-10.05  sec  3.81 GBytes  3.26 Gbits/sec  615             sender</span><br><span class="line">[  5]   0.00-10.00  sec  3.81 GBytes  3.27 Gbits/sec                  receiver</span><br><span class="line">[  7]   0.00-10.05  sec  3.46 GBytes  2.96 Gbits/sec  423             sender</span><br><span class="line">[  7]   0.00-10.00  sec  3.46 GBytes  2.97 Gbits/sec                  receiver</span><br><span class="line">[  9]   0.00-10.05  sec  3.79 GBytes  3.24 Gbits/sec  623             sender</span><br><span class="line">[  9]   0.00-10.00  sec  3.78 GBytes  3.25 Gbits/sec                  receiver</span><br><span class="line">[SUM]   0.00-10.05  sec  11.1 GBytes  9.45 Gbits/sec  1661             sender</span><br><span class="line">[SUM]   0.00-10.00  sec  11.1 GBytes  9.49 Gbits/sec                  receiver</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>(Ryzen 7 5700G、メモリDDR4-3200 DIMM (PC4-25600)32GByte)<br>このPCにはPCIe×16のスロットにConnect X-4を、PCIe x4のスロットにConnect X-3を挿しています。</p>
<p>少しリトライが多いようですが、9.49Gbpsです。<code>-R -P3</code>オプションとして逆方向の送信（ダウンロード）、多重度3のみ、それ以外のオプションは指定していません。Windows10時代でも多重度は4程度から9.3Gbpsをマークしていたと記憶しているので、まずまずでしょうか。Windows11側がダウンロード側ですのでUbuntu側の送信速度に少し追いついていないようです。これはドライバが最適化されていない可能性もあります。しかし、実運用として使うのであれば十分でしょう。</p>
<h3 id="Connect-X-4"><a href="#Connect-X-4" class="headerlink" title="Connect X-4"></a>Connect X-4</h3><p>Connect X-4はWindows11で自動導入されるドライバは2020年のものですが、新しいドライバをNvidiaからダウンロードできます。</p>
<img src="/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/x4.png" class="" width="480" title="alt">

<p>NVidiaではSoftwareのEthernetの分類でドライバを検索することになります。<br><a target="_blank" rel="noopener" href="https://developer.nvidia.com/networking/ethernet-software">https://developer.nvidia.com/networking/ethernet-software</a></p>
<p>具体的には、以下のWinOF-2がWin10以降のドライバとなります。</p>
<blockquote>
<p>MLNX_OFED for Windows - WinOF &#x2F; WinOF-2<br> <a target="_blank" rel="noopener" href="https://network.nvidia.com/products/adapter-software/ethernet/windows/winof-2/">https://network.nvidia.com/products/adapter-software/ethernet/windows/winof-2/</a></p>
</blockquote>
<p>Connect X-4は2023年2月2日に発表されたRevision3.20.50010が最新のようですが、実際のドライバは上記のキャプチャの通り、3.2.25がインストールされます。</p>
<p>セットアップはただインストーラの指示に従い、進めていくだけなので何も難しいものはありません。</p>
<img src="/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/setup.png" class="" width="480" title="alt">

<h2 id="Connect-X-4のスループット"><a href="#Connect-X-4のスループット" class="headerlink" title="Connect X-4のスループット"></a>Connect X-4のスループット</h2><p>PCのConnect X-4（SFP28スロット）にSFP＋モジュールを挿入し、対向もスイッチに挿します。</p>
<p>Connect X-3もConnect X-4も同じ10GbEとして使うなら変わらないように思えますが、ドライバの違いもさることながら能力は結構違います。<br>多重度1でUbuntuに対して実行した結果です。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Connect X-4 flow control send</span><br><span class="line"></span><br><span class="line">[ ID] Interval           Transfer     Bitrate</span><br><span class="line">[  5]   0.00-1.00   sec  1.11 GBytes  9.51 Gbits/sec</span><br><span class="line">[  5]   1.00-2.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   2.00-3.00   sec  1.10 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   3.00-4.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   4.00-5.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   5.00-6.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   6.00-7.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   7.00-8.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   8.00-9.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   9.00-10.00  sec  1.10 GBytes  9.49 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[ ID] Interval           Transfer     Bitrate</span><br><span class="line">[  5]   0.00-10.00  sec  11.1 GBytes  9.49 Gbits/sec                  sender</span><br><span class="line">[  5]   0.00-10.04  sec  11.0 GBytes  9.45 Gbits/sec                  receiver</span><br><span class="line"></span><br><span class="line">Connect X-4 flow control recv</span><br><span class="line"></span><br><span class="line">[ ID] Interval           Transfer     Bitrate</span><br><span class="line">[  5]   0.00-1.00   sec  1.11 GBytes  9.51 Gbits/sec</span><br><span class="line">[  5]   1.00-2.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   2.00-3.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   3.00-4.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   4.00-5.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   5.00-6.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   6.00-7.00   sec  1.10 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   7.00-8.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   8.00-9.00   sec  1.10 GBytes  9.48 Gbits/sec</span><br><span class="line">[  5]   9.00-10.00  sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[ ID] Interval           Transfer     Bitrate         Retr</span><br><span class="line">[  5]   0.00-10.05  sec  11.1 GBytes  9.45 Gbits/sec    0             sender</span><br><span class="line">[  5]   0.00-10.00  sec  11.1 GBytes  9.49 Gbits/sec                  receiver</span><br></pre></td></tr></table></figure>

<p>非常に安定していますね。Windowsのiperf3のシングルプロセスでRetryが0です。<br>ちなみにこれだけ安定しているならということでスイッチのフローコントロールを外してみます。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Connect X-4 no flow control send</span><br><span class="line"></span><br><span class="line">[ ID] Interval           Transfer     Bitrate</span><br><span class="line">[  5]   0.00-1.00   sec  1.11 GBytes  9.52 Gbits/sec</span><br><span class="line">[  5]   1.00-2.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   2.00-3.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   3.00-4.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   4.00-5.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   5.00-6.00   sec  1.10 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   6.00-7.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   7.00-8.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   8.00-9.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   9.00-10.00  sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[ ID] Interval           Transfer     Bitrate</span><br><span class="line">[  5]   0.00-10.00  sec  11.1 GBytes  9.50 Gbits/sec                  sender</span><br><span class="line">[  5]   0.00-10.04  sec  11.1 GBytes  9.45 Gbits/sec                  receiver</span><br><span class="line"></span><br><span class="line">Connect X-4 no flow control recv</span><br><span class="line"></span><br><span class="line">[ ID] Interval           Transfer     Bitrate</span><br><span class="line">[  5]   0.00-1.00   sec  1.11 GBytes  9.49 Gbits/sec</span><br><span class="line">[  5]   1.00-2.00   sec  1.10 GBytes  9.47 Gbits/sec</span><br><span class="line">[  5]   2.00-3.00   sec  1.10 GBytes  9.47 Gbits/sec</span><br><span class="line">[  5]   3.00-4.00   sec  1.10 GBytes  9.47 Gbits/sec</span><br><span class="line">[  5]   4.00-5.00   sec  1.10 GBytes  9.47 Gbits/sec</span><br><span class="line">[  5]   5.00-6.00   sec  1.10 GBytes  9.47 Gbits/sec</span><br><span class="line">[  5]   6.00-7.00   sec  1.10 GBytes  9.47 Gbits/sec</span><br><span class="line">[  5]   7.00-8.00   sec  1.10 GBytes  9.47 Gbits/sec</span><br><span class="line">[  5]   8.00-9.00   sec  1.10 GBytes  9.47 Gbits/sec</span><br><span class="line">[  5]   9.00-10.00  sec  1.10 GBytes  9.45 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[ ID] Interval           Transfer     Bitrate         Retr</span><br><span class="line">[  5]   0.00-10.05  sec  11.0 GBytes  9.42 Gbits/sec    0             sender</span><br><span class="line">[  5]   0.00-10.00  sec  11.0 GBytes  9.47 Gbits/sec                  receiver</span><br></pre></td></tr></table></figure>

<p>フローコントロール無しでこれは良い結果です。もっとも、アプリケーション（iperf3）が再送を必要としていないだけであって、NIC同士がオフロードして送受信管理するのでOSまでその情報は見えていないと考えられます。昔はとても高価かつ使いこなすのが難しいNICでしたが、シンプルに使うだけであれば、容易にその高い性能がホームユーザーにも享受できるようになってきました。</p>
<h2 id="Connect-Xのファームウェア更新（Windows版）"><a href="#Connect-Xのファームウェア更新（Windows版）" class="headerlink" title="Connect Xのファームウェア更新（Windows版）"></a>Connect Xのファームウェア更新（Windows版）</h2><p>特にMellanoxのNICで脆弱性という話を聞いたことはなく、頻繁にパッチが出ないので本当に運用が楽ではありますが購入時にファームウェアを更新しておきましょう。「<a href="/new-technology/2022/04/02/nic-firmware/" title="ESXiでネットワークカードのファームウェアを更新する">ESXiでネットワークカードのファームウェアを更新する</a>」ではネットに接続されていない前提としてパッチを個別にダウンロードしましたが、Windowsの場合はネットに接続されている事が前提でしょうから、もう少し手間は省けます（ESXiホスト自身はNTPなど限定されたサービスを除きインターネットアクセスしないのが一般的です）。</p>
<p>WindowsにおいてMellanoxカードのファームウェアの更新にはMFTとmlxupの2つのツールが必要です。<br>まずMFTのインストールになります。以下のURLからMFTをダウンロードします。</p>
<blockquote>
<p>NVIDIA Firmware Tools (MFT)<br> <a target="_blank" rel="noopener" href="https://network.nvidia.com/products/adapter-software/firmware-tools/">https://network.nvidia.com/products/adapter-software/firmware-tools/</a></p>
</blockquote>
<p>2023-3-25時点では、2023-1-31リリースの4.23.0が最新のようです。<br>MFTもインストーラーで特に悩むこともなくセットアップを完了させます。OSを再起動するとMFTツールは自動起動されますが、再起動しなくともコマンドプロンプトから<code>mst server start</code>でサービスが起動します。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\yoshi&gt;mst server start</span><br><span class="line"></span><br><span class="line">C:\Users\yoshi&gt;Waiting for connection on port 23108</span><br></pre></td></tr></table></figure>
<p>引き続き、管理者権限のコマンドプロンプトを開き、<code>mst status</code>を実行するとNICの情報が得られます。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32&gt;mst status</span><br><span class="line">MST devices:</span><br><span class="line">------------</span><br><span class="line"></span><br><span class="line">  mt4117_pciconf0</span><br><span class="line"></span><br><span class="line">C:\Windows\System32&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>続いてmlxupのダウンロードです。これはexeファイルそのものなので、ブラウザからのダウンロード時に警告が出るかもしれません。</p>
<blockquote>
<p>mlxup - Update and Query Utility<br> <a target="_blank" rel="noopener" href="https://network.nvidia.com/support/firmware/mlxup-mft/">https://network.nvidia.com/support/firmware/mlxup-mft/</a></p>
</blockquote>
<p>ダウンロードしたら、コマンドプロンプトにて<code>mlxup.exe --query</code>を実行します。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mlxup --query</span><br><span class="line"></span><br><span class="line">Querying Mellanox devices firmware ...</span><br><span class="line"></span><br><span class="line">Device #1:</span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line">  Device Type:      ConnectX4LX</span><br><span class="line">  Part Number:      MCX4121A-ACA_Ax</span><br><span class="line">  Description:      ConnectX-4 Lx EN network interface card; 25GbE dual-port SFP28; PCIe3.0 x8; ROHS R6</span><br><span class="line">  PSID:             MT_2420110034</span><br><span class="line">  PCI Device Name:  mt4117_pciconf0</span><br><span class="line">  Base MAC:         0c42a1000000</span><br><span class="line">  Versions:         Current        Available</span><br><span class="line">     FW             14.25.1020     14.32.1010</span><br><span class="line">     PXE            3.5.0701       3.6.0502</span><br><span class="line">     UEFI           14.18.0019     14.25.0017</span><br><span class="line"></span><br><span class="line">  Status:           Update required</span><br></pre></td></tr></table></figure>

<p>するとこのようにファームウェアの情報とアップデート可能か否かの情報が得られます。<br>実際のファームウェアの更新は<code>mlxup --online</code>です。これで適切なファームウェアがダウンロードされ適用されます。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\yoshi\Downloads&gt;mlxup --online</span><br><span class="line">Querying Mellanox devices firmware ...</span><br><span class="line"></span><br><span class="line">Device #1:</span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line">  Device Type:      ConnectX4LX</span><br><span class="line">  Part Number:      MCX4121A-ACA_Ax</span><br><span class="line">  Description:      ConnectX-4 Lx EN network interface card; 25GbE dual-port SFP28; PCIe3.0 x8; ROHS R6</span><br><span class="line">  PSID:             MT_2420110034</span><br><span class="line">  PCI Device Name:  mt4117_pciconf0</span><br><span class="line">  Base MAC:         0c42a1000000</span><br><span class="line">  Versions:         Current        Available</span><br><span class="line">     FW             14.25.1020     14.32.1010</span><br><span class="line">     PXE            3.5.0701       3.6.0502</span><br><span class="line">     UEFI           14.18.0019     14.25.0017</span><br><span class="line"></span><br><span class="line">  Status:           Update required</span><br><span class="line"></span><br><span class="line">Release notes for the available Firmware:</span><br><span class="line">-----------------------------------------</span><br><span class="line"></span><br><span class="line">  For more details, please refer to the following FW release notes:</span><br><span class="line">    1- ConnectX3 (2.42.5000):    http://www.mellanox.com/pdf/firmware/ConnectX3-FW-2_42_5000-release_notes.pdf</span><br><span class="line">    2- ConnectX3Pro (2.42.5000): http://www.mellanox.com/pdf/firmware/ConnectX3Pro-FW-2_42_5000-release_notes.pdf</span><br><span class="line">    3- Connect-IB (10.16.1200):  http://www.mellanox.com/pdf/firmware/ConnectIB-FW-10_16_1200-release_notes.pdf</span><br><span class="line">    4- ConnectX4 (12.28.2006):   http://docs.mellanox.com/display/ConnectX4Firmwarev12282006</span><br><span class="line">    5- ConnectX4Lx (14.32.1010): http://docs.mellanox.com/display/ConnectX4LxFirmwarev14321010</span><br><span class="line">    6- ConnectX5 (16.35.2000):   http://docs.mellanox.com/display/ConnectX5Firmwarev16352000</span><br><span class="line">    7- ConnectX6 (20.36.1010):   http://docs.mellanox.com/display/ConnectX6Firmwarev20361010</span><br><span class="line">    8- ConnectX6Dx (22.36.1010):   http://docs.mellanox.com/display/ConnectX6DxFirmwarev22361010</span><br><span class="line">    9- ConnectX6Lx (26.36.1010):   http://docs.mellanox.com/display/ConnectX6LxFirmwarev26361010</span><br><span class="line">    10- BlueField2 (24.35.2000):   http://docs.mellanox.com/display/BlueField2Firmwarev24352000</span><br><span class="line">    11- ConnectX7 (28.36.1010):   http://docs.mellanox.com/display/ConnectX7Firmwarev28361010</span><br><span class="line"></span><br><span class="line">---------</span><br><span class="line">Found 1 device(s) requiring firmware update...</span><br><span class="line"></span><br><span class="line">Perform FW update? [y/N]: y</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CMD: mlxup -u --log-on-update --ssl-certificate C:\Users\yoshi\AppData\Local\Temp\sfxter_yoshi_3512\mlxup-dir\ca-bundle.crt --current-dir C:\Users\yoshi\Downloads\  --online</span><br><span class="line">Querying Mellanox devices firmware ...</span><br><span class="line"></span><br><span class="line">Device #1:</span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line">  Device Type:      ConnectX4LX</span><br><span class="line">  Part Number:      MCX4121A-ACA_Ax</span><br><span class="line">  Description:      ConnectX-4 Lx EN network interface card; 25GbE dual-port SFP28; PCIe3.0 x8; ROHS R6</span><br><span class="line">  PSID:             MT_2420110034</span><br><span class="line">  PCI Device Name:  mt4117_pciconf0</span><br><span class="line">  Base MAC:         0c42a1000000</span><br><span class="line">  Versions:         Current        Available</span><br><span class="line">     FW             14.25.1020     14.32.1010</span><br><span class="line">     PXE            3.5.0701       3.6.0502</span><br><span class="line">     UEFI           14.18.0019     14.25.0017</span><br><span class="line"></span><br><span class="line">  Status:           Update required</span><br><span class="line"></span><br><span class="line">Release notes for the available Firmware:</span><br><span class="line">-----------------------------------------</span><br><span class="line"></span><br><span class="line">  For more details, please refer to the following FW release notes:</span><br><span class="line">    1- ConnectX3 (2.42.5000):    http://www.mellanox.com/pdf/firmware/ConnectX3-FW-2_42_5000-release_notes.pdf</span><br><span class="line">    2- ConnectX3Pro (2.42.5000): http://www.mellanox.com/pdf/firmware/ConnectX3Pro-FW-2_42_5000-release_notes.pdf</span><br><span class="line">    3- Connect-IB (10.16.1200):  http://www.mellanox.com/pdf/firmware/ConnectIB-FW-10_16_1200-release_notes.pdf</span><br><span class="line">    4- ConnectX4 (12.28.2006):   http://docs.mellanox.com/display/ConnectX4Firmwarev12282006</span><br><span class="line">    5- ConnectX4Lx (14.32.1010): http://docs.mellanox.com/display/ConnectX4LxFirmwarev14321010</span><br><span class="line">    6- ConnectX5 (16.35.2000):   http://docs.mellanox.com/display/ConnectX5Firmwarev16352000</span><br><span class="line">    7- ConnectX6 (20.36.1010):   http://docs.mellanox.com/display/ConnectX6Firmwarev20361010</span><br><span class="line">    8- ConnectX6Dx (22.36.1010):   http://docs.mellanox.com/display/ConnectX6DxFirmwarev22361010</span><br><span class="line">    9- ConnectX6Lx (26.36.1010):   http://docs.mellanox.com/display/ConnectX6LxFirmwarev26361010</span><br><span class="line">    10- BlueField2 (24.35.2000):   http://docs.mellanox.com/display/BlueField2Firmwarev24352000</span><br><span class="line">    11- ConnectX7 (28.36.1010):   http://docs.mellanox.com/display/ConnectX7Firmwarev28361010</span><br><span class="line"></span><br><span class="line">---------</span><br><span class="line">Found 1 device(s) requiring firmware update...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Please wait while downloading MFA(s) ...</span><br><span class="line">Device #1: Updating FW ...</span><br><span class="line"></span><br><span class="line">FSMST_INITIALIZE -   OK</span><br><span class="line"></span><br><span class="line">Writing Boot image component -   0%</span><br><span class="line">Writing Boot image component -   1%</span><br><span class="line">Writing Boot image component -   2%</span><br><span class="line">(省略)</span><br><span class="line">Writing Boot image component - 100%</span><br><span class="line">Writing Boot image component -   OK</span><br><span class="line">Done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Restart needed for updates to take effect.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>最後にOSをリブートして完了です。ESXiよりはずいぶん簡単ですね。</p>
<p>個別のファームウェアを適用したい場合は、mlxupのダウンロードページにUser Manualのリンクがありますので参照してください。</p>
<h2 id="PCIe-x4スロット"><a href="#PCIe-x4スロット" class="headerlink" title="PCIe x4スロット"></a>PCIe x4スロット</h2><p>さて、エイプリールフールも近いのでネタを1つご紹介します。<br>今回紹介したMellanox Connect X-4の必要レーン数は、PCIe x8です。グラフィックカードをPCIe x16に挿していらっしゃる方は残りのPCIe x4のスロットしか使えず、最初からPCIe x8のネットワークカードは候補に上がらないと思います。</p>
<p>私のもう1台のPC（Ryzen5 5600G）のPCIe x4のスロットです（PCIe3 x4で動作）。物理的なスロットは長いですが、接続端子がx4の部分までしかありません（画像をクリックして拡大できます）。</p>
<img src="/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/pci1.png" class="" width="1024" title="alt">

<p>Connect X-4を挿すところです。どう見てもレーン数が不足しています。</p>
<img src="/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/pci2.png" class="" width="1024" title="alt">

<p>とりあえずはスロットにConnect X-4を差し込み、Windows11を起動すると無事にカードは認識されています。<strong>SFP28モジュール</strong>とOM3ケーブルとを使ってスイッチに繋いでみます。</p>
<img src="/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/unifi1.png" class="" width="1024" title="alt">

<p>（UbiquitiのSwitch Pro Aggregationスイッチは4つのSFP28ポートを持っています。見た目はSFP+と区別がつきませんが、右側の4PortがSFP28です）</p>
<p>iperf3のテストです。Windows11同士、それぞれがConnectx-4で片方がPCIe x4です。多重度は2です。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">iperf3 PCIe x4 Ryzen5(SFP28) &lt;- Ryzen7(SFP28)</span><br><span class="line"></span><br><span class="line">C:\Users\yoshi&gt;iperf3 -c 192.168.x.165 -R -P2</span><br><span class="line">Connecting to host 192.168.x.165, port 5201</span><br><span class="line">Reverse mode, remote host 192.168.x.165 is sending</span><br><span class="line">[  5] <span class="built_in">local</span> 192.168.x.112 port 49813 connected to 192.168.x.165 port 5201</span><br><span class="line">[  7] <span class="built_in">local</span> 192.168.x.112 port 49814 connected to 192.168.x.165 port 5201</span><br><span class="line">[ ID] Interval           Transfer     Bitrate</span><br><span class="line">[  5]   0.00-1.00   sec  1.37 GBytes  11.8 Gbits/sec</span><br><span class="line">[  7]   0.00-1.00   sec  1.35 GBytes  11.6 Gbits/sec</span><br><span class="line">[SUM]   0.00-1.00   sec  2.72 GBytes  23.3 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[  5]   1.00-2.00   sec  1.38 GBytes  11.9 Gbits/sec</span><br><span class="line">[  7]   1.00-2.00   sec  1.38 GBytes  11.9 Gbits/sec</span><br><span class="line">[SUM]   1.00-2.00   sec  2.76 GBytes  23.7 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[  5]   2.00-3.00   sec  1.38 GBytes  11.9 Gbits/sec</span><br><span class="line">[  7]   2.00-3.00   sec  1.38 GBytes  11.9 Gbits/sec</span><br><span class="line">[SUM]   2.00-3.00   sec  2.76 GBytes  23.7 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[  5]   3.00-4.00   sec  1.38 GBytes  11.9 Gbits/sec</span><br><span class="line">[  7]   3.00-4.00   sec  1.38 GBytes  11.9 Gbits/sec</span><br><span class="line">[SUM]   3.00-4.00   sec  2.76 GBytes  23.7 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[  5]   4.00-5.00   sec  1.38 GBytes  11.9 Gbits/sec</span><br><span class="line">[  7]   4.00-5.00   sec  1.38 GBytes  11.9 Gbits/sec</span><br><span class="line">[SUM]   4.00-5.00   sec  2.76 GBytes  23.7 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[  5]   5.00-6.00   sec  1.38 GBytes  11.9 Gbits/sec</span><br><span class="line">[  7]   5.00-6.00   sec  1.38 GBytes  11.9 Gbits/sec</span><br><span class="line">[SUM]   5.00-6.00   sec  2.76 GBytes  23.7 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[  5]   6.00-7.00   sec  1.38 GBytes  11.9 Gbits/sec</span><br><span class="line">[  7]   6.00-7.00   sec  1.38 GBytes  11.9 Gbits/sec</span><br><span class="line">[SUM]   6.00-7.00   sec  2.76 GBytes  23.7 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[  5]   7.00-8.00   sec  1.38 GBytes  11.9 Gbits/sec</span><br><span class="line">[  7]   7.00-8.00   sec  1.38 GBytes  11.9 Gbits/sec</span><br><span class="line">[SUM]   7.00-8.00   sec  2.76 GBytes  23.7 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[  5]   8.00-9.00   sec  1.35 GBytes  11.6 Gbits/sec</span><br><span class="line">[  7]   8.00-9.00   sec  1.39 GBytes  11.9 Gbits/sec</span><br><span class="line">[SUM]   8.00-9.00   sec  2.74 GBytes  23.5 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[  5]   9.00-10.00  sec  1.39 GBytes  11.9 Gbits/sec</span><br><span class="line">[  7]   9.00-10.00  sec  1.35 GBytes  11.6 Gbits/sec</span><br><span class="line">[SUM]   9.00-10.00  sec  2.73 GBytes  23.5 Gbits/sec</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[ ID] Interval           Transfer     Bitrate</span><br><span class="line">[  5]   0.00-10.00  sec  13.8 GBytes  11.8 Gbits/sec                  sender</span><br><span class="line">[  5]   0.00-10.00  sec  13.8 GBytes  11.8 Gbits/sec                  receiver</span><br><span class="line">[  7]   0.00-10.00  sec  13.8 GBytes  11.8 Gbits/sec                  sender</span><br><span class="line">[  7]   0.00-10.00  sec  13.8 GBytes  11.8 Gbits/sec                  receiver</span><br><span class="line">[SUM]   0.00-10.00  sec  27.5 GBytes  23.6 Gbits/sec                  sender</span><br><span class="line">[SUM]   0.00-10.00  sec  27.5 GBytes  23.6 Gbits/sec                  receiver</span><br><span class="line"></span><br><span class="line">iperf Done.</span><br></pre></td></tr></table></figure>

<p>中途半端な繋ぎ方ですが、25GbEワイヤレートの速度がしっかり出ています。25GbEの全二重通信の検証まではやっていませんが、そもそもPCIe x8で25GbEが2Portならば、PCIe x4で25GbEの1Portはいけるでしょうし、10GbEなら2Portともに大丈夫でしょう。</p>
<p>まるでギャンブルですが、エイプリールフールでした、、、ということではありません。Mellanox Connect X-4はこういった接続方法に対応しています。</p>
<img src="/new-technology/2023/03/25/Mellanox-ConnectXandWindows11/mellanox.png" class="" width="480" title="alt">

<p>冒頭で紹介した製品スペックのPDFでは、赤枠で囲ったところに、オートネゴシエートとあります。理論上、PCIe3 x4では帯域が32Gbpsですから25Gbpsの通信は可能ということになります。</p>
<p>どうしても先入観があって、x4のスロットにx8のカードを挿そうと思いませんよね。</p>
<p>PCIeのレーン数はご利用のマザーボードによって様々な仕様がありますので事前のご確認をお勧めします。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/new-technology/tags/SFP/" rel="tag"><i class="fa fa-tag"></i> SFP+</a>
              <a href="/new-technology/tags/10GbE/" rel="tag"><i class="fa fa-tag"></i> 10GbE</a>
              <a href="/new-technology/tags/25GbE/" rel="tag"><i class="fa fa-tag"></i> 25GbE</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/new-technology/2023/02/23/xg-v195mr1/" rel="prev" title="Sophos Firewall v19.5 MR-1">
                  <i class="fa fa-angle-left"></i> Sophos Firewall v19.5 MR-1
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/new-technology/2023/04/29/l2-esxi/" rel="next" title="L2ネットワークとESXi">
                  L2ネットワークとESXi <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2020 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">阿部　吉伸(Yoshinobu ABE)</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div><script src="https://cdn.jsdelivr.net/npm/simple-gdpr@1.1.5/dist/simplegdpr.umd.js"></script>
<link href="https://cdn.jsdelivr.net/npm/simple-gdpr@1.1.5/dist/simplegdpr.min.css" rel="stylesheet">

<script>
if (Cookies.get('PRVCY202112') != 'Agree') {
  const notice = new SimpleGDPR({
    title: 'Accept Cookies & Privacy Policy?',
    message: 'このWebサイトでは、訪問や活動に関するデータがクッキー等によって収集されます。閲覧を継続される場合、\
    プライバシーポリシーをご覧いただき同意(Agree)をお願いします',
    link: null,
    icons: true,
    theme: 'light',
    animation: 'fade',
    float: 'bottom-right',
      callback: () => {
      notice.close();
      Cookies.set('PRVCY202112', 'Agree', { expires: 365, path: '/'});
      notice.destroy();
      // Google Analytics 4
      gtag('consent', 'update', {
      'analytics_storage': 'granted'
      });
      gtag('js', new Date());
      gtag('config', 'G-JMY6NSC2KK', { 'anonymize_ip': true });
      },
  });
}
</script>
<div class="disclaimer1">
このサイトの記事は、特別な記載がない限り <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja">クリエイティブ・コモンズ BY-NC-SA ライセンス</a>で保護されています</div>



    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/yoshi0808" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="/new-technology/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="/new-technology/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
<script src="/new-technology/js/comments.js"></script><script src="/new-technology/js/utils.js"></script><script src="/new-technology/js/motion.js"></script><script src="/new-technology/js/schemes/muse.js"></script><script src="/new-technology/js/sidebar.js"></script><script src="/new-technology/js/next-boot.js"></script>

  <script src="/new-technology/lib/hexo-generator-searchdb/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/new-technology/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/new-technology/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script>
  <script src="/new-technology/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
