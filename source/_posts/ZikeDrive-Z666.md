---
title: ZikeDrive Z666 USB4エンクロージャー
date: 2024-01-13T09:56:03+09:00
tags:
- ZikeDrive
- M.2 NVMe
- USB4
- Thunderbolt3
- Thunderbolt4
- MinisForum UM790 Pro
- Lexar NM790
- SK hynics Platinum P41
categories:
- [Hardware]
---


{% asset_img title.png 1024 alt %}
<p class="onepoint">この記事で実現すること</p>

USB4 40Gbpsに対応したNVMe　M.2対応のSSDエンクロージャーを紹介します。いわゆる外付けディスクです。ノートPCの外付けとして直近のNVMe M.2 SSDの状況を鑑みつつ、USB4/Thunderbolt4/Thunderbolt3などプロトコルの違い、実運用における速度を見ていきます。

<!-- more -->
## 背景

2023年はSSDがとても廉価だった年でした。非常に高性能なNANDフラッシュメモリが台頭してきた事もあり、外付けSSDとしての利用価値が高まってきています。USB-Cのコネクタ形状はiPhone15での対応もあり、最近デファクトになりつつある規格ですが、一方で新しいPCやMacではUSB4/Thunderbolt4への対応が進んでいます。OS本体のストレージとは別に目的やジャンル別のデータ保存に外付けディスクを”切り替える”使い方もあろうかと思います。特にノートPCのディスク容量は大きくないですし、あまり使わないデータは外付けディスクで管理したいところです。

これまでUSB-CのSSDエンクロージャーといえば、USB3.2 Gen2の10Gbpsで接続可能なもの、一般的にはRealtekのRTL9210チップを搭載した安価なものが多くを占めます。今回のZIKE Z666は40Gbps対応となり、今のNVMeの能力を活かすことが期待できます。

## ZIKE Z666

ZIKEはアメリカ発のベンチャー企業で、2021年に起業したアメリカのデラウェア州にある企業です。

- ZIKE
 <https://ziketech.com>

商品説明のページでは、Z666は3,811MB/sの読み取り速度と3,199 MB/sの書き込み速度があるとの事。1USB3.2Gen2のSSD外付けドライブの3倍速です。ASMediaのAS2464PDチップを備え、USB4ケーブルが付属、NVMeの取り付けに工具不要。ケースそのものはアルミで作られ、その周りを透明なABS樹脂で覆ったものとなっています。サイズは112×66.8×18(mm)、重さ245gとなっており従来のエンクロージャと比べれば大きめです。外への持ち出しを考えられて作られてます。50度を超え70度にもなるNVMeを直接アルミで放熱することは機械にとっては良くても、人にとっては優しくないわけですが、一般消費者向けに（きちんと）作られた製品です。

{% asset_img zike-1.png 1024 alt %}

ストレージの制限があるノート、特にMacbookのユーザーから人気があります。エンクロージャに取り付け可能な短いケーブルが付属します。Z666はあくまでエンクロージャーですので、中身のNVMeは別途購入する必要があります。
スペックの概略は以下の通りです。

| 各スペック     | 説明                                                                                |
| -------------- | ----------------------------------------------------------------------------------- |
| インタフェース | USB4 40Gbps Thunderbolt3/4互換、USB3.2Gen2 10Gbps、USB3.2Gen1 5Gbps、USB2.0 480Mbps |
| SSD形状        | M.2 M-Key PCIe Gen 4x4/2280                                                         |
| 容量           | 1、2、4、16TBまたはそれ以上                                                         |
| 互換性         | Windows,MacOS,Linux,iPad,PlayStation                                                |

AS2464PDチップとNVMeとの間がPCIe Gen4x4というのが魅力です。
ファームウェアのアップデートもウェブサイトで公開されており、質問やユーザーレポートの投稿も可能です。

詳細は、Zikeのウェブサイトで確認してください。
- Z666
 <https://ziketech.com/products/zikedrive-worlds-first-and-fastest-usb4-ssd-drive?variant=42809341608097>

## ベンチマーク

ここで利用するSSDについて紹介します。速度だけでいえば、WD_Black SN850X NVMeやSamsungの990Proがメジャーです。しかし、ケーブル接続する外付けディスクの利用目的としてはそこまで速度を求めるものでもないでしょうから、それに準ずる比較的廉価な製品を選定して確認していきます。Gen4x4の速度が必要であればマザーボードに直接NVMeをセットされる事をお勧めします。

まずは、SK hynics PLATINUM P41 NVMe 2TBで確認します。
{% asset_img p41.png 480 alt %}

PLATINUM P41は990Pro、SN850Xと比較し価格は少し廉価ですが、2TBのモデルで速度はRead 7,000MB/s、Write 6,500MB/sであり、990ProのRead 7,450MB/s、Write Write 6,900MB/sの速度に迫り実力としては十分です。このモデルはDRAMを持っているので、ベンチマークには有利です。

### Windows CrystalDiskmark

{% asset_img CrystalDiskMark.png 480 alt %}

ハードウェアはMinisForum UM790 Pro(Windows11 Home)で、USB4ポートで確認しました。フォーマットはexFATです。スペック通りの速度です（書き込みはスペック以上の速度です）。

デバイスマネージャーから取り外しポリシーを高パフォーマンスに変更するとランダム書き込みの値が改善します。これは普段から接続しっぱなしの方にお勧めの設定です。

{% asset_img policy.png 480 alt %}

{% asset_img HighPerformance.png 480 alt %}

###　macOSのベンチマーク

{% asset_img AmorphousDiskMark.png 480 alt %}

Macbook Pro(M2)のThunderbolt4ポートで確認しました。フォーマットはAPFSです。Windowsよりは速度は落ちますが、アプリケーションが違うものなので単純比較は難しいところです。macOSでは他にBlackmagicというDiskパフォーマンスベンチマークソフトがあります。

{% asset_img Blackmagic.png 480 alt %}

前回の記事「{% post_link MiniSSDCase %}」で書いた小型のRTL9210エンクロージャではRead/Writeともに980MB/s程度でしたから格段に速度が向上しています。
もちろん、USB4に対応していないUSB3.x Gen2のホストにZ666を接続した場合は10Gbpsと速度は落ちますが、アクセス可能です。

USB3.2 Gen2のエンクロージャーをご利用されている方は、読み込み書き込み共にCrystalDiskMarkのシーケンシャルで1,000MB/s前後の数字を目にされているのでは無いでしょうか。これは8Gbps前後になりますので、USBを経由する実効速度は理論値よりは2割ほど落ちます。

今回は最も遅い箇所が40Gbpsのケーブルですから5GB/sが理論値となり、それの8割とすれば4GB/sです。Windowsの結果を見れば大体このような数字なのかなと感じます。

##　Z666のケース構造

Z666のフタはプラでパチンと嵌め込む形になっているので、手で押し開けます。

{% asset_img zike-2.png 1024 alt %}

上蓋には3mm厚程度のサーマルパッドがあります。本体内部下部にはNVMeを支える2つの長方形のクッションが糊付けされています。
NVMeはラバープラグを回転させて固定させる方式です。お世辞にもしっかりと固定されるとはいえませんが蓋を閉めるので大丈夫ということでしょうか。頻繁にNVMeの入れ替えを行う場合を想定して便利に作られています。
内部のクッションは剥がせそうではありますが、基本的に片面実装（チップが片方のみあるもの）のNVMeを想定しているようです。
また上蓋にサーマルパッドがあることから、ヒートシンク付きのNVMeは使えません。物理的には接続可能ですが、その場合は蓋が閉まりません。

ケースはABS樹脂とアルミの隙間があるため、ここから熱を逃すようです。ケースの外側はほんのり暖かい程度で熱さは感じません。

##　Z666の購入

ZIKEのWebサイトから海外通販で購入することになります。shopPayがあるので、Ubiquitiなどの他の通販で利用されている場合は再度住所の登録が不要です。日本からは送料無料で1月初旬で18,000円弱です（為替で変動するようです）。

レビューを見ていると結構楽しいです。皆さんCrystalDiskMarkの画面ショットを貼り付けていらして、このような光景は世界共通ですね。
速いのでLaptopでSQL Serverに使えるというコメントがあったり、M2 Ultra Mac Studioに990Proを付けて3200/3100のBlackMagicベンチマーク結果で「こんなものなのかな」というコメントなど、平和ですね。

##　SSDの進化

NVMeに限らず、SSDにはDRAMキャッシュがあるもの、ないものと2種類の製品が存在します。

以下は、PLATINUM P41　2TBを横から撮影したものです。
{% asset_img NVMe.png 1024 alt %}

右側のM.2コネクタから順に、コントローラー、DRAM、NANDフラッシュ2枚が並んでいます。M.2コネクタから近い順に速いチップを配置していくのが基本です。
各社凌ぎを削っている部分ですが、このような配置だとNANDフラッシュは1TBづつ配置されている事になります。
コントローラー、DRAMキャッシュ、NANDフラッシュと片面実装にするためにギリギリで詰め込まれているのがわかります。
176層というNANDフラッシュ1つに1TB、それを2個搭載する事で2TBという容量を実現しています。

ただ、このデザインから見えるように、すでに基盤上はチップで埋まっているので、これ以上NANDフラッシュメモリを追加できません。さらに片面のまま4TBの容量とするには微細化が求められることになります。PLATINUM P41の製品バリエーションとして最大容量は2TBとなっています。
WD SN850Xの4TBはいくつかの第三者レビューを見る限りではNANDフラッシュが裏面に2枚あるそうで両面実装となっています。

Samsungの990Proの4TBは片面実装になっています。王者の貫禄というか、意地でしょうか。凄まじさを感じさせます。

{% cq %}

4TB NVMe Laptop Upgrade
It’s the one and only on the market—the 990 PRO 4TB is now compatible with laptops. Thanks to Samsung’s NAND Stacking technology, 990 PRO is the first 4TB m.2 NVMe Internal SSD with a single-sided form—meaning it fits easily in the most popular laptops for an instant upgrade in high-performing storage.

4TB NVMeラップトップ・アップグレード
990 PRO 4TBがラップトップに唯一無二の存在となりました。サムスンのNANDスタッキング・テクノロジーのおかげで、990 PROは、片面実装の初の4TB  M.2 NVMe内蔵SSDとなりました。
つまり、高性能ストレージを即座にアップグレードするために、最も人気のあるラップトップに簡単に収まることを意味します。
{% endcq %}

- Samsung
 <https://www.samsung.com/us/computing/memory-storage/solid-state-drives/990-pro-pcie-4-0-nvme-ssd-4tb-mz-v9p4t0b-am/>

## SSDの選択

先ほど紹介したZIKEの掲示板では高額なホストに高額なNVMe(990Pro)を付けたからといって大したパフォーマンスの向上は見込めないように見えます。

ケーブルやUSBを経由するオーバーヘッドがある場合には、SSD側のDRAMキャッシュがある程度有効になります。NANDフラッシュへの遅い書き込みをカバーするために、できるだけ応答を早く返すことで遅いケーブル上での待ちを少なくすることが重要です。

速度以外にも、容量の確保、発熱を抑えることも、コストを抑えることも大事です。

ZIKEの掲示板でもLexarのNM790というNVMeが紹介されていました。Lexarは昔からカメラを趣味にしている人であればよく知られているブランドで世界的にも有名です。

このNM790はYMTCの232層NANDフラッシュとMaxioのMAP1602Aコントローラーを使ったNVMeです。他社でもこの組み合わせのNVMeは大量に出回っています。

このモデルは、DRAMレスとなっており、SK hynicsのものよりは1回り小さいNANDチップが4枚片面に乗せられています。コントローラーも1回りサイズが小さくなっており、うまく片面に乗せられたという感じです。このコントローラーは4多重で動作でき、負荷分散ができます。RAIDシステムで分散して処理速度を稼ぐのと同じ考え方ですね。ローテクな感じですが、負荷分散によりボトルネックが小さく、DRAMキャッシュの複雑な機構も不要ですので、廉価で低発熱が期待できます。

### 各SSDをZ666で速度テスト

手元には以下のNVMeを用意し、Macbookで速度検証してみます。
- Samsung 970EVO Plus 1TB
- SK hynics PLATINUM P41 2TB
- Lexar NM790 2TB

テスト結果は以下のとおりです。
| テスト項目         | Samsung     | SK hynics    | Lexar |
| ------------------ | ----------- | ------------ | ----- |
|                    | 970EVO Plus | PLATINUM P41 | NM790 |
| SEQ1M Q8　Read     | 3368        | 3386         | 3379  |
| SEQ1M Q1　Read     | 2901        | 3120         | 3028  |
| RND4K QD64　Read   | 890         | 916          | 905   |
| RND4k QD1　Read    | 62          | 65           | 68    |
| SEQ1M Q8　Write    | 1312        | 3178         | 2679  |
| SEQ1M Q1　Write    | 1176        | 2677         | 2887  |
| RND4K QD64　Write  | 262         | 305          | 221   |
| RND4k QD1　Write   | 46          | 44           | 31    |
| コントローラー温度 | 65          | 61           | 47    |
| DRAM温度           | 84          | 72           | -     |
| NAND温度           | 72          | 60           | 50    |

※パフォーマンスのテスト数値はMB/s、温度は摂氏となります。DiskMarkを2回実行し、赤外線で計測するタイプの温度計でチップ表面を計測し、一番温度の高い数値を採用しています。
- 970EVO Plus（PCIe3x4）のSEQ Readはカタログスペック3,500MBなので読み込みのボトルネックは発生していない。
- 970EVO Plus（PCIe3x4）のSEQ Writeはカタログスペック3,300MBなのでこの環境では半分以下に落ち込んでいる。逆に言えば、ホスト、ADMediaチップ、NVMeのコントローラーがPCIe4x4で揃っていればボトルネックが生まれにくい。
- PCIe4x4対応のPLATINUM P41とNM790のシーケンシャル処理はReadにせよWriteにせよ3,300MBあたりが壁になっている。Macbook本体やASMediaチップがPCIe4x4（理論値64Gbps）であってもケーブルが最大40Gbpsの制約、プロトコル変換のオーバーヘッドに加え、Macbook/macOSが持つ何らかの要因によるオーバーヘッドがあると考えられる（Windwos11と比較しても遅く見える）。
- DRAMキャッシュがないNM790は大量のランダムな書き込みには特に弱い。PCIe3x4の970EVO Plusを下回る。
- 970EVO Plusは速度が頭打ちになっているにも関わらず発熱量はかなり大きい。
- NM970はかなり温度が低い。DRAMを使わない分処理が単純なのとNANDチップが高性能というのも一理あるかもしれない。

廉価にPCIe4x4のNVMeを使える機会があるのであれば無理にPCIe3x4の970EVO Plusを使う意味は無さそうです。
なお、容量が4TBとなると、この3つのうちではNM790が候補になります。

あくまでベンチマークだけの話なので参考に留めていただけると幸いです。WindowsのCrystalDiskMarkはスレッド数（多重度）も指定できましたが、macOS版では特に指定がありません。1スレッドという事なのかもしれません。

#### 大きなサイズのファイルコピー

ESXiの仮想マシンvmdkファイル42.95GByteを対象とし、macOSからZ666へ書き込みます。

| テスト項目                        | 970EVO Plus | PLATINUM P41 | NM790 |
| --------------------------------- | ----------- | ------------ | ----- |
| 42.95GBファイルをMac→Z666へコピー | 31秒        | 13秒         | 16秒  |

この結果を見る限りではやはりPCIe4x4のチームが有利ですね。外付けDiskで40GByteのファイルが10秒台というのは魅力的です。PLATINUM P41でベンチマークのシーケンシャルWrite処理を超える3.3GB/sという数値が出ています。素晴らしい結果ですが、やっぱりMacBook Pro（M2）では何かしらの3.3GBの壁があるように見えます。

#### 小さなサイズの多くの数のファイルコピー

このブログで使っているモジュール群のNode Moduleやgitは細かいファイルをたくさん生成します。
2.07GBのフォルダに、54,301ファイルが存在しています。

| テスト項目                           | 970EVO Plus | PLATINUM P41 | NM790 |
| ------------------------------------ | ----------- | ------------ | ----- |
| 54,301個のファイルをMac→Z666へコピー | 23秒        | 23秒         | 23秒  |

| テスト項目                           | 970EVO Plus | PLATINUM P41 | NM790 |
| ------------------------------------ | ----------- | ------------ | ----- |
| 54,301個のファイルをZ666→Macへコピー | 21秒        | 21秒         | 22秒  |

OS処理のオーバーヘッドが大きいようで各NVMeでほぼ同じ時間となりました。ランダムに弱いという点はベンチマークではありましたが、バックアップ目的での小さなファイルコピーを中心に利用するならばあまりメディアの違いは関係なさそうです。速度はおおよそ90MB/sです。

RTL9210の10Gbps対応のエンクロージャにNM790をセットして書き込んでみます。
結果は26秒でした。OSが細かいファイルを処理する事はやはりオーバーヘッドが大きいため、90MB/s程度の速度であれば高速デバイスのメリットは活かしきれず、USB3.2 Gen2とUSB4との違いはありません。

今回のケースでは敢えて極端な例を示していますが、一般的によく利用される写真、動画、文書などのファイルであれば効率的にZ666のパフォーマンスを活かせます。

## USB/Thunderboltと対応PC

USBについてのおさらいです。

| USB規格名                  | データ転送速度 | 旧名称              | マーケティング名                                       |
| -------------------------- | -------------- | ------------------- | ------------------------------------------------------ |
| USB3.2 Gen1                | 5Gbps          | USB3.1 Gen1、USB3.0 | USB　5Gbps、旧（SuperSpeedUSB、SSマーク）              |
| USB3.2 Gen2                | 10Gbps         | USB3.1 Gen2         | USB　10Gbps、旧（同上）                                |
| USB3.2 Gen2x2、USB4 Gen2x2 | 20Gbps         |                     | USB  20Gbps、旧（SuperSpeed USB 20Gbps、USB4  20Gbps） |
| USB4 Gen3x2                | 40Gbps         |                     | USB 40Gbps、旧（USB4 40Gbps）                          |
| USB4 Ver2.0                | 80Gbps         |                     |                                                        |

まずZ666を利用するにあたり、最低限度の必要な確認です。お使いのPCでUSB4(Thunderbolt4/Thunderbolt3)に対応していなければZ666のメリットは活かしきれません。私はUSB3.2Gen2x2のホストを保有していないので確認できませんが、ASMediaのASM2464PDの紹介ページではUSB3.2、USB2.0の後方互換があると記載されています。USB-Cがあってもお使いのPCがUSB3.2 Gen2止まりであれば従来のRealtekのRTL9210のエンクロージャーで十分です。

- ASMedia ASM2464PD
 <https://www.asmedia.com.tw/product/802zX91Yw3tsFgm4/C64ZX59yu4sY1GW5>

USB4はThunderbolt3をベースに作られています。同じUSB-Cの形状でもUSBポート、Thunderbolt3/4ポートの違いがあり、それぞれのプロトコルの違いがあるので一層理解が難しくなっているのが現状です。

Thunderbolt3は40Gbps対応とはいえ、Requirement（要求事項）は最低16GbpsのPCIeデータのサポートが求められています。Altモードでデータ、ディスプレイへの出力の合計で40Gbpsです。

|                        | Thundrerbolt4                                  | Thunderbolt3     |
| ---------------------- | ---------------------------------------------- | ---------------- |
| 総帯域幅               | 40Gbps                                         | 40Gbps           |
| データ転送の最小帯域幅 | 32Gbps                                         | 16Gbps           |
| ディスプレイ           | 4K  モニター最大 2 台、または 8K モニター 1 台 | 4K モニター 1 台 |

2018年以降のmacbookをお使いの方はThunderbolt3対応になっていると思います。Windows(intel)のノートPCではThunderbolt3に対応した機種もあります。新しいWindowsノートPCはUSB4に対応したモデルも出てきていますね。外付けディスクだけを考えた場合、Thunderbolt3対応というのはデータ転送において最低16Gbpsを満たす事ですから、外付けディスクで16Gbpsの速度しか出なくても文句は言えません。但し、Requirementと実装とは異なることも多いので個別のホストを確認しないと分かりません。

macのポートの対応については以下を確認してください。

- Apple Macのポートを調べる
 <https://support.apple.com/ja-jp/HT201736>

 M1 MacなどはThunderbolt/USB4と記載があります。本当はThunderbolt4と書きたいところだったんでしょうけれども何か規格に満たないものがあり、こういった表現に留めているのだと思われます。

Z666はUSB4に対応したモデルであり、Thunderboltプロトコルとは互換性があります。
MacBook ProでZ666とを接続し、システム情報を参照するとThunderbolt4ではなくUSB4モードで接続されています。

``` bash
  製造元名:	Gopod Group Limited.
  装置名:	USB4 NVMe SSD Pro Enclosure
  モード:	USB4
  装置ID:	0xD666
  製造元ID:	0x2D01
  デバイスのリビジョン:	0x5A
  ファームウェアのバージョン:	1.87
  状況:	装置は接続済み
  リンクの状況:	0x2
  速度:	最高40Gb/秒×1
  現在のリンク幅:	0x2

```

一方、2019年のintel版Macbook AirはUSB4には対応していませんが、Thunderbolt3には対応しています。

``` bash
  製造元名:	Gopod Group Limited.
  装置名:	USB4 NVMe SSD Pro Enclosure
  モード:	Thunderbolt 3
  装置ID:	0xD666
  製造元ID:	0x1CA
  デバイスのリビジョン:	0xE3
  ファームウェアのバージョン:	1.87
  状況:	装置は接続済み
  リンクの状況:	0x2
  速度:	最高40Gb/秒×1
  現在のリンク幅:	0x2


```

intel版Macbook AirをDiskMarkで確認してみます。

{% asset_img MBAir.png 480 alt %}

もしかしたら遅くなるのかなと考えていましたが、Requirement（16Gbps）以上の良いパフォーマンスを発揮しました。少なくとも32Gbpsは対応してそうです。

###　ケーブルについて

80cmのThunderbolt3ケーブルはUSB4で問題なく使えます。1mを超えるThunderbolt3のパッシブケーブルは20Gbpsですので、十分なパフォーマンスが出ない場合があります。距離が必要であれば少し高額ですが、2mのThunderbolt4アクティブケーブルを用意することになります。私はPlugableのThunderboltケーブルを好んで使っています（Amazonで購入できます）。iPhoneの充電には白色のAmazon Basicのケーブル（通信速度480Mbps）、データ通信用はPD充電（100W）を兼ねて黒色のThunderboltケーブルと使い分けています。

Z666を使う分には別途ケーブルを購入する必要はありませんが、微妙な接触不良などが思わぬトラブルの原因になるため、事前の確認をお勧めします。Z666に限らず、エンクロージャーを動かしたら切断警告が出たという経験をお持ちの方も多いのではないでしょうか。Z666に付属のケーブルも短すぎてエンクロージャを動かした時に端子に負担を掛けます。しなやかなで、ある程度の長さがあり、端子に負担を掛けないケーブルを利用されることをお勧めします。

## SSDの暗号化

メディアの持ち出しなどのためにWindowsであれば**Bitlocker To Go**、macOSであれば**APFS（暗号化）**でのフォーマットをお勧めします。

Bitlocker To GoはWindows Homeでは使えない機能ですが、一度Proで作成してしまえば、Windows Homeでもファイルの読み込み・書き込みが可能です（将来的にはHomeでは使えなくなる可能性があります）。パフォーマンスについてはDiskMarkを見ている限りではランダムは少し速度が落ちますが、シーケンシャルはMac OS、Windowsともに暗号化しない時と殆ど変わりません。

macOS、Windowsとともに、次回からパスワードを省略できます（macOSはキーチェーンに保存）ので自宅PCでの利用においてはパスワードを意識する事なく便利です。

## Windowsにおける実運用

Z666にBitLocker ToGoで暗号化された2TBのLexar NM790をセットして書き込みのテストを実施してみます。
エクスプローラーでコピーし、対象は写真・動画で、209GBのフォルダサイズです。

まずはDiskの取り外しポリシーをクイック取り外し（既定：キャッシュ無し）の通常のコピーをパフォーマンスモニターで記録しました。
項目はDisk Write Bytes/secおよびCurrent Disk Queue Lengthです。Disk Queue Lengthは一般的に2を超える数値だとディスクにボトルネックがあると伝統的に言われています。ハードディスク時代のサーバー管理における一般論ですのであくまで参考値です。
4分25秒でコピーが完了しています。

### Lexar NM790 書き込みキャッシュ無し

{% asset_img perfmon-nocache.png 640 alt %}

緑色のグラフはDisk Write Bytes/secで、左の凡例の10の数が1,000Mbpsを示します。
赤色のグラフはDisk Queue Lengthで、左の凡例の10の数が1を示します。

計算上は約788MB/sでファイルがコピーされていますが、実際にNVMeに書き込んだ内容は860MB/sです。凡そ1,000MB/sでコピーしており、最後の20秒で速度が落ちています。速度が落ちた理由はNVMeのSLCバッファが枯渇したものと思われ、200MB/sあたりまで落ち込み、Disk Queue Lengthも2のままが継続する比率が高くなっています（青色の枠で囲った部分）。SLCバッファの枯渇はSSDの宿命とも言え、やむを得ませんが、取り外しポリシーがクイック取り外し、暗号化、数MB単位の小さいファイルもあれば、これくらいの速度が現実的です。

Disk Queue Lengthは取り外しポリシーの制約があり、Diskへの負担はあまり大きくありません。

### Lexar NM790 書き込みキャッシュ有り

取り外しポリシーを高パフォーマンスにします。コピー時間は凡そ1分50秒で2分35秒の短縮です。計算上は約1,900MB/sです。

{% asset_img perfmon-cache.png 640 alt %}

前回同様、後半はSLCバッファが枯渇して数値が落ち込むと考えられますが、グラフを見る限りは後半を除けば2,000MB/s〜3,000MBの速度でNVMeに書き込んでいます。最初から4〜6あたりのDisk Queue Lengthが発生しており、十分NVMeへの負荷も確認できます。但し、断続的に高止まりしているわけではなく、0〜8の間で行ったり来たりしていますから、ファイルサイズが変化する状況で速度に変化があると考えられます。
グラフを眺めていると、後半30秒はDisk Write Bytes/secの値が落ち込むと同時にDisk Queue Lengthの数値は若干高い傾向が見られます（青色の枠で囲った部分）。最後の5秒はDisk Write Bytes/secがかなり落ち込みNVMeに対する信頼性として一瞬不安になりますが、実際の書き込み量が減るものの、Queueは発生していないのでボトルネックは発生していないと考えられます。

10gbpsのエンクロージャーを使った場合は、取り外しポリシーを高パフォーマンスの時のDisk Write Bytes/secは凡そ950MB/sで、クイック取り外しの時は600MB/sでした（後半の処理速度低下部分を除く）。

### SK hynics PLATINUM P41

PLATINUM P41の高パフォーマンスでの結果です。コピーの結果は1分35秒でNM790よりは15秒ほど高速でした。

{% asset_img perfmon-p41.png 640 alt %}

このNVMeの特性として、初動はスロースタートです。Disk Queue Lengthがいきなり8まで上がります。これはmacOSのベンチマークで確認した際にも少し気になりました。
Disk Queue LengthはNM790よりはやや低い数値で安定しています。NM790はQueueが0と8の間を絶えず行ったり来たりしています。一方、P41のQueueは2と3が中心で、時々0になったり4以上となり変動が少ない状況です。これらはDRAMキャッシュの効果といえます。実際のコピー時間として見た場合はNM790と比較してそれほど顕著な差は見受けられません。単純にコピーではない、動画編集処理やゲームなど低レイテンシが求められるような用途には向いていると考えられます。

## まとめ

最後のWindowsでのテストはリアルな速度を示しました。SSDの容量が埋まっている場合はSLCバッファの数も足りなくなり、これよりもパフォーマンスは落ち込むものと考えられますが、今回の検証の目的からも外れるため、ここまでといたします。

結論として、外付けディスクの速度を上げるためには、デバイスコントローラー（AS2464PD）、ケーブル（Thunderbolt4／USB4）、NVMeメディア（PCIe4x4）、ホストコントローラー（PC本体）のすべての速度をバランス良く高める必要があります。

私は4TBのNM790でMacbookのバックアップ（TimeMachine）のパーティションを1TB、その他動画・写真の管理・編集および映画や音楽、モジュールのダウンロードなどを3TBとしてシンプルな用途で使っています。色々なデータでTimeMachineのバックアップが膨らんでいくのも避けたいと考えています。

ZIKEDRIVE Z666が登場したこと、高速なNVMeが登場したことで、外付けディスクは実運用でかなり快適に使えるようになりました。

## 補足

Z666のファームウェアは2024年1月3日に更改されたものの、アップデータとしてのConfigが誤っているようでアップデートが出来ません。
単にファームのファイル名が誤っているように見えて、Configを修正すれば実行できるとは思いますが、他のパラメータもたくさんあり、一旦はZIKE社に問い合わせています。また情報が得られたら記事をアップデートしたいと思います。
