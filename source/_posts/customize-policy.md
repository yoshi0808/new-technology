---
title: XG Firewall v18のポリシーをカスタマイズする
date: 2020-03-14 13:51:51
tags:
  - XG Firewall
categories:
  - Security
---

<p class="onepoint">この記事で実現すること</p>

XG FirewallのWebポリシーをカスタマイズし、コンテンツのカテゴリ（ギャンブル、アダルト、Webメール）毎にアクセスを許可するか否かを設定できるようになります。また閲覧を拒否するドメインをインターネット上にあるデータベース等から入手し、XGに取り込む事ができるようになります。

<!-- more -->

## ポリシーのカスタマイズ

XGにおけるWebのポリシーというのはコンテンツのカテゴリを意味し、カテゴリによってアクセスを認めない制御が可能です。ギャンブル、アダルトからネットショッピングやチャットやWebメールまで多岐に渡ります。設定を行うには左ペインの"Web"をクリックします。

{% asset_img web1.png alt %}

”Default Policy”の内容がまず最初に表示されているはずです。初期値では、"Blocked URLs for Default Policy"と2番目の行に"Risky Downloads"および"Suspicious（※怪しいもの）"が選択されています。"Risky Downloads"、"Suspicious"が含まれていると、Google検索で"広告"という表示のあるページを正しく表示出来ない場合があります。レイヤ7Firewallルールのポリシーはこういった箇所のカスタマイズが重要となります。これらのポリシーは、[Sophosのサイト「Sophos XG Firewall: Web カテゴリ」](https://community.sophos.com/kb/ja-jp/134155)にも日本語の解説があります。この内容を見ながらWebポリシーのカスタマイズを行ってください。この部分は防御というよりは倫理の概念です。膨大なサイトの分類が既に登録されている事は素晴らしい事ですが、さらに自分で分類を追加する事も可能です。

## 外部データベースを取り込む

XGは外部のデータベース（ドメインのリスト形式）を取り込む事が可能です。ここでは[280blocker | モバイル広告ブロッカー](https://280blocker.net/)のデータを取り込んでみます。名称の通り、スマホでの広告をカットするために利用されるデータベースです。利用については、[ダウンロードのページ](https://280blocker.net/download/)の注意事項の確認をいただき、ご自身で利用の判断をお願いします。

1. ダウンロードするデータとして"広告ドメインリスト（リスト形式）"をダウンロードします
2. XGの左ペインメニューの{% label @Web %}を選択し、"カテゴリ"のタブをクリックします
3. 名前は"280blocker"とします
4. 分類は"Objectionable"とします
5. 設定のカテゴリはローカルのラジオボタンを選択します
6. domainのインポートから、先ほどダウンロードしたファイルを選択し取り込みます
7. "保存"ボタンをクリックします

{% asset_img web2.png alt %}


引き続き、{% label @Web %}の{% label @ユーザーアクティビティ %}をクリックします。

1. 画面右上の{% label @追加 %}ボタンをクリックします
2. 名前は"280blocker"とします
3. 先ほど"カテゴリ"で作成した"280blocker"を選択し適用します
4. 最後に"保存"ボタンを押します

再びWebのポリシータブをクリックし、"Default Policy"の内容を表示します。ここで右側の編集（ペンのアイコン）を選択します。

1. ルールの追加ボタンを押すと、先頭にルールが作成されます

{% asset_img web3.png alt %}

2. 先頭ルールのアクティビティを選択し"すべてのWebトラフィック"を削除し、"280blocker"を追加します
3. "アクション"は"HTTPをブロックする"という赤い盾のバツ印が表示されていますが、そのままにします
4. ステータスのトグルをOnにしてください
5. 最後に画面を下にスクロールし、保存ボタンをクリックします

これでブラウザやスマホなどで広告のあるサイトを閲覧すると広告が消えている事がわかります。また、ログビューアからWebフィルタを選択すると、"カテゴリ"に280blockerとURLが表示され赤字で拒否されています。スマホに広告ブロッカーを導入する事と結果は同じですが、XGで一括管理できるのとクライアントOSの種類に限らずIoTにも有効ですので導入する価値はあります。
