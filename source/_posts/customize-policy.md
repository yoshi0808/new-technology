---
title: XG Firewall v18のポリシーをカスタマイズする
date: 2020-03-14 13:51:51
tags:
  - XG Firewall
categories:
  - Security
---

{% note success  %}

## この記事で実現する内容について

XG FirewallのWebポリシーをカスタマイズし、コンテンツのカテゴリ（ギャンブル、アダルト、Webメール）毎にアクセスを許可するか否かを設定できるようになります。また閲覧を拒否するドメインをインターネット上にあるデータベース等から入手し、XGに取り込む事ができるようになります。

{% endnote %}
<!-- more -->

## ポリシーのカスタマイズ

XGにおけるWebのポリシーというのはコンテンツのカテゴリを意味し、カテゴリによってアクセスを認めない制御が可能です。ギャンブル、アダルトからネットショッピングやチャットやWebメールまで多岐に渡ります。設定を行うには左ペインの「Web」をクリックします。

{% asset_img rule3.png alt %}

前回の記事、{% post_link rule-policy2 %}で設定した”Default Policy”の内容がまず最初に表示されているはずです。初期値では、"Blocked URLs for Default Policy"と2番目の行に"Risky Downloads"および"Suspicious（※怪しいもの）"が選択されています。"Risky Downloads"および"Suspicious"が含まれていると、Google検索で"広告"という表示のあるページを正しく表示出来ない場合があります。今後説明するSSLインスペクションの対応が出来た際に改めて加える事とし、一旦"Risky Downloads"および"Suspicious"を外すなど好みで調整してみてください。"Suspicious"に広告のWebサイトが含まれるためこのような挙動になります。このポリシーについては、XGを運用していくに従って人それぞれの使い方によって微修正が必要なものですので、ここでの説明はあくまで一例として捉えてください。

## 外部データベース（ドメインリスト）を取り込む

XGは外部のデータベース（ドメインのリスト形式）を取り込む事が可能です。ここではサンプル的に[280blocker | モバイル広告ブロッカー](https://280blocker.net/)のデータを取り込んでみます。名称の通り、スマホでの広告をカットするために利用されるデータベースです。利用については、[ダウンロードのページ](https://280blocker.net/download/)の注意事項の確認をいただき、ご自身で利用の判断をお願いします。

1. ダウンロードするデータとして”広告ドメインリスト（リスト形式）"をダウンロードします
2. XGの左ペインメニューの{% label @Web %}を選択し、"カテゴリ"のタブをクリックします
3. 名前は"280blocker"とします
4. 分類は"Objectionable"とします
5. 設定のカテゴリはローカルのラジオボタンを選択します
6. domainのインポートから、先ほどダウンロードしたファイルを選択し取り込みます
7. {% label @保存 %}ボタンをクリックします

次にWebのユーザーアクティビティの設定です。

{% asset_img rule4.png alt %}

1. 画面右上の{% label @追加 %}ボタンをクリックします
2. 名前は"280blocker"とします
3. 先ほど"カテゴリ"で作成した"280blocker"を選択し適用します
4. 最後に{% label @保存 %}ボタンを押します

再びWebのポリシータブをクリックし、”Default Policy"の内容を表示します。ここで右側の編集（ペンのアイコン）を選択します。

{% asset_img rule5.png alt %}

1. ルールの追加ボタンを押すと、先頭にルールが作成されます
2. 先頭ルールのアクティビティを選択し"すべてのトラフィック"を削除し、"280blocker"を追加します
3. アクションは"HTTPをブロックする"というデフォルトのままです
4. ステータスのトグルをOnにしてください
5. 最後に画面を下にスクロールし、保存ボタンをクリックします

これでブラウザやスマホなどで広告のあるサイトを閲覧すると広告が消えている事がわかります。スマホに広告ブロッカーを導入する事と結果は同じですが、XGで一括管理できるのとクライアントOSの種類に限らずIoTにも有効ですので導入する価値はあります。
