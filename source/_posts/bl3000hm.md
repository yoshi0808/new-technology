---
title: auひかり BL3000HM
date: 2023-01-28T9:00:00+09:00
tags:
- 10GbE
categories:
- [Hardware]
- [Network]
---

{% asset_img bl3000hm.png 240 alt %}
<p class="onepoint">この記事で実現すること</p>

auひかりの新しいホームゲートウェイ（HGW)に交換してみたのでレポートします。ONUと一体型となったモデルです。Wi-Fi6Eにも対応しています。私はauひかりのWi-Fiは契約していないため、Wi-Fi以外の基本性能・機能について紹介します。
<!-- more -->

## auひかりホームユーザー向け、HGW交換の案内

auひかりではこれまでもユーザーの希望によるホームゲートウェイの交換について、半導体不足により一時的に交換を停止していましたが、昨年末に再開するという案内がありました。

> 2022/12/22 auひかり ホームゲートウェイ：お客さまのご要望による交換（希望交換）の再開について
 <https://www.au.com/information/notice_internet/service/20221220-01/>

私はこれまでホーム5ギガユーザーとしてBL1000HW（HGW）と10G-PON（ONU）をレンタルで利用していましたが、ONU一体型のHGWになるということで多少のレイテンシと消費電力の改善期待があり早速交換のお願いをしました。交換には3,300円掛かるとの記載があります。電話回線が2回線ある場合はBL3000HMには交換できないようです。
インターネット回線によるスピードテストでも3ギガ程度は出ており全く不満はありませんが、5ギガと10ギガの差額が月額780円なので、10ギガの契約に併せて変更もしました。

## auひかりホーム10ギガ・5ギガについて

auひかりのホーム10ギガ・5ギガサービスは関東圏の一部エリアのみ提供となっています。IPv4/IPv6デュアルスタックで複雑な設定が不要で高速インターネットが利用できます。
ホーム10ギガ・5ギガのサービス説明は以下を参照してください。

> auひかり ホーム10ギガ・5ギガ
 <https://www.au.com/internet/auhikari_10-5g/>

基本情報、マニュアルは以下を参照してください。

> auひかり ホームゲートウェイ Aterm BL3000HM
 <https://www.au.com/support/service/internet/guide/modem/bl3000hm/>

## BL3000HM

年末に申し込んで年明け早々にBL3000HM（BL3000：右側）が届きました。BL1000（左側）も大きかったですがBL3000はかなり大きいと感じます。交換は自分で行います。

{% asset_img bl3000-1.png 1024 alt %}

横幅28cm程度もありますね。私の場合はクローゼットの中に収まるので大きさは特に気になりませんが、リビングに配置するとなると少し目立つサイズです。

BL3000には、上記写真にある通り、ひかり回線と接続するコネクタ付きのシングルモードファイバケーブル（約3m）が既に取り付けられています。説明書には約3mと書いてありますが、これ3mもあるかな。。。その他付属品として電源ケーブル（アース無し）とLANケーブル（1.5m）があります。

| 機種     | 消費電力    | アース | LANケーブル |
| -------- | ----------- | ------ | ----------- |
| BL3000HM | 45W（最大） | 無し   | Cat6A STP   |
| BL1000HW | 34W(最大)   | 無し   | Cat6A STP   |
| 10G-EPON | 14.3W以下   | 無し   | Cat6A STP   |

最大消費電力だけで見るとBL1000とONUとを合計したものとBL3000と比較した場合は大して変わりません。BL1000、BL3000共にWi-Fi機能を持ちますから、Wi-Fiを使わない場合はそれなりに電力が抑えられているものと思います。付属のケーブルは前回も今回も変わらず、Cat6Aのシールドツイストペア（STP）です。STPを使う場合には正しいアースが云々というご意見もあるようですが、短いケーブルについて気にすることは無いということでしょう。LAN4というRJ45の口が10GbEですが、5G/2.5G/1G/100Base-TXにも対応しています。

早速、BL3000のファイバケーブルを光回線に接続し直し、LANケーブルを10GbEポートに接続し、電源を入れてみます。

{% asset_img wchecker.png 360 alt %}

普段のアイドル状態で16.35w、2.5Gbps程度のアップロード時で16.5Wです。やはりネットワーク機器なのでNATやフィルタ処理などを除いたルーティングは通信専用のチップ（ASIC）が対応するため通信量と電力とは殆ど関係ありません。

## 回線速度

さて、いつものSpeedtestです。HGWとスイッチとをRJ45で接続し、スイッチとMacBook-AirとをSFP+で接続して計測してみます。平日の夕方に計測しました。

HGWのLANに接続
{% asset_img speedtest1.png 360 alt %}

Sophos Firewall（TLS／SSLインスペクション有り）を通した速度
{% asset_img speedtest2.png 360 alt %}

HGWのLANに接続した場合は5Gbps以上の速度が出ています。一方、FirewallのTLS/SSLインスペクションを通しても下りはさほど落ちていません。上りは流石にデータ漏洩の観点から厳しくチェックするのでこれくらいには落ちてしまうのは仕方がないところでしょうか。自宅内のFirewallを通してもレイテンシ（Ping）が3ミリ秒という表示になっており、かなりの低遅延のネットワークになっていると言えそうです。これまでは4ミリ秒でした。

朝方の計測はHGW直結で5Gbps〜6Gbps程度の速度です。

## ログ機能

今回のHGWは簡単なログ機能が付いています。HGWのデフォルトのLANのIPアドレスは`192.168.0.1/24`です。

{% asset_img log.png 800 alt %}

## スイッチ部分

BL1000HWと同様、BL3000HMも10GbEが1Port、1GbEが3Portとなります。
{% asset_img sw.png 360 alt %}

一般的に、スイッチ機能を持つ1Gのチップ（PHY）は4Port単位で組まれることが多いです。10GbEと1GbEと合わせて4Portというのは、実際に10GbEに対応した4PortのPHYに1GbEの3Portが接続されているのでは？と妄想してしまいます。

10Gポートと1Gポートとのスループットはどうでしょうか。10Gポートには、Mellanox Connect-X3(10G SFP+)を挿したUbuntu22をSFP+スイッチ経由で接続し、1GポートにはMacBook-AirにPlaggableのUSBアダプタを挿してiperf3を実行してみます。

``` bash
yoshi@ub22:~$ iperf3 -c 192.168.0.3
Connecting to host 192.168.0.3, port 5201
[  5] local 192.168.0.4 port 48032 connected to 192.168.0.3 port 5201
[ ID] Interval           Transfer     Bitrate         Retr  Cwnd
[  5]   0.00-1.00   sec   115 MBytes   963 Mbits/sec    0   3.77 MBytes
[  5]   1.00-2.00   sec   112 MBytes   944 Mbits/sec    0   3.77 MBytes
[  5]   2.00-3.00   sec   112 MBytes   944 Mbits/sec    0   3.96 MBytes
[  5]   3.00-4.00   sec   111 MBytes   933 Mbits/sec    0   3.96 MBytes
[  5]   4.00-5.00   sec   112 MBytes   944 Mbits/sec    0   3.96 MBytes
[  5]   5.00-6.00   sec   112 MBytes   944 Mbits/sec    0   3.96 MBytes
[  5]   6.00-7.00   sec   112 MBytes   944 Mbits/sec    0   3.96 MBytes
[  5]   7.00-8.00   sec   112 MBytes   944 Mbits/sec    0   3.96 MBytes
[  5]   8.00-9.00   sec   111 MBytes   933 Mbits/sec    0   3.96 MBytes
[  5]   9.00-10.00  sec   112 MBytes   944 Mbits/sec    0   3.96 MBytes
- - - - - - - - - - - - - - - - - - - - - - - - -
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.00  sec  1.10 GBytes   944 Mbits/sec    0             sender
[  5]   0.00-10.03  sec  1.10 GBytes   941 Mbits/sec                  receiver
```

文句なしのパフォーマンスです。このタイミングでワットチェッカーを確認してみました。

{% asset_img wchecker2.png 360 alt %}

10GbEに加え、1GbEのRJ45をBL3000HMに接続しているため、ベースの消費電力は16.787Wとなっています。10GbEのみと比べ、0.43W消費電力が増えています。
これにiperf3を実行したタイミングでは、16.84Wとなり、僅か0.07W弱の消費電力が上昇しています。非常に誠実な作りであると思われます。

10GのPHYは単体であったり、2Port、4Portと様々な種類がありますが、他の製品のHGWやWi-Fiルーターで1GbEが4Port、10GbEが1Portある製品を見た時には、それらを繋ぐのはどうやっているのかな？と気になります。ASICではなくCPU（ソフトウェア）で相互にパケットをやり取りしている製品もあるらしく、10GbEと1GbEの通信のパフォーマンスが出ないそうです。

## レイテンシとアプリケーション

私は10Gbpsのトラフィックを必要としていませんが、こういった多段のセグメントを介するネットワーク構成(VLAN)/仮想環境/Firewall/アンチウィルス/アプリケーションFirewallを組み合わせているため、少しでもレイテンシが大きくなるのを防ぎたいという狙いがあります。こうやって全体を俯瞰して見ると、セキュリティのためとはいえ、レイテンシが大きくなるような事ばかりしているわけです。

私の使っているアンチウィルスソフトのBitDefenderはそれ単体でTLS/SSLインスペクションを実行するため、なおさら遅くなります。

最近のファイル転送プロトコルであればファイルのやり取りに高度な並列処理を実施することでトータルのデータ転送量を稼ぎますが、アプリケーションによっては単一のTCPセッションによるやり取りとなります。そのようなアプリケーションはいくら回線が太くても、到底大きな転送量はこなせません。数10Mbps程度の速度でもレイテンシが大きく関係するようになります。

高速回線と聞けば、ストリーミングビデオを思いつく方が多いでしょうか。4Kの映画や音楽配信サービスなどは負担が大きそうに思えるかもしれません。しかしこのようなサービスはデータの先読みができて、いくらでもバッファに積めます。1秒後どころか1分後に再生すべきであろうデータは全て読み込んでおけるので回線が多少不安定でも並列度を高めてデータ受信することで全く問題ありません。
しかし、電話であればそうはいきません。データの安定度を高めるために0.2秒程度のバッファは持ちますが、それ以上のバッファを持ち、遅延させると電話による会話が噛み合わなくなります。現代のリモートワークでも同時に発言してお互い譲り合うというのは見慣れた光景かもしれません。ホームユーザーであれば、リモートワークはもちろん、オンライン授業・コミュニティや友人・家族・親戚とのビデオ通話などが該当するでしょう。こういったビデオ通話ではデータの先読みが殆ど出来ないため、ネットワークの品質とレイテンシが大きく影響します。

私はオンラインゲームはしませんが、これもビデオ会議と同様でしょう。TCP通信では遅すぎるのでUDP通信でアプリケーション固有のプロトコルでやりとりすることになるでしょうか。私は自宅の環境でパケットロスを認識できるほどの経験はありませんが、回線の太さ以前に、パケット損失が大きく出てしまうプロバイダや回線業者もあるようです。私が10ギガネットワークを使いたいというのは光回線で、通信業者自体が持つバックボーンに（レイテンシが極めて小さい）大型ネットワーク機器が収容されていることを期待しています。さらに言えば、Apple、Googleなどの主要IT、CloudflareやAkamaiなどのCDN（コンテンツ・デリバリ・ネットワーク）、AWSやAzureなどのクラウドサービスにネットワーク的に近い環境が好ましいとも言えます。

私が利用しているSophos Firewallではレポート機能でビデオ会議のトラフィックを確認できます。

{% asset_img sophos.png 1024 alt %}

{% label primary @Conferencing %} でフィルタすると、Teams会議、Zoom会議がクラウドアプリケーションとして判定され、サーバーIPアドレスも列挙されます。

実例として、Microsoft365のTeamsのサーバーにpingでレイテンシを計測してみます。
{% asset_img ping.png 1024 alt %}

10分程度、pingの往復レイテンシを計測しています。平均4.6msであり、非常に低レイテンシでスパイクもせいぜい20ms以下ですから安定していると言えます。サーバーIPアドレスをGeo Locationで見ると場所は米国のマイクロソフト社になりますが、レイテンシから鑑みると関東近辺のデータセンターになると思われます。私の感覚的なものですが、米国の西海岸までは純粋なネットワークだけで往復100msのレイテンシ、東海岸までは往復150ms程度はあるはずです。実際のサーバーとの往復だと数百msにはなるようです。

なお、PCをWi-Fi6接続に変更すると、6.8msとなり、2.2ms遅延が追加されます。

## auひかりのホーム5ギガ、ホーム10ギガの違い

今回、HGWの交換によって若干のレイテンシ改善は確認できましたが、スループットとして大きく変わるような結果はありません。恐らく地域によって結果は大きく異なると思われます。なお、auひかりの場合は増速の際には事前の調査が必要なようで、混雑している地域だと10ギガへの変更が行えないとの事。ここ2、3年で1ギガを超える光回線の提供も随分浸透してきたと思われるので、時間帯によって帯域制限が加わっているような感覚をお持ちの方は一度確認されてはいかがでしょうか。

## 契約変更

機器交換には3,300円必要とauのホームページには記載がありましたが、以下の案内が事後に郵送されてきました。3,300円の交換に加えて2,000円の交換手数料が掛かるがそれは無料ということなのか、そもそも3,300円ではなく2,000円になるのか、或いは都合良く解釈すれば機器交換は無料なのか。。。また、プロバイダがau one netで10ギガに増速した場合、12ヶ月の間、780円（税込858円）を割り引くとの事です。こちらも次月の請求がわかったところでアップデートしたいと思いますが、そもそもの最初の契約の仕方によって人それぞれで割引プランが異なるのかもしれませんね。
（私はプロバイダはau one netでどこのアフェリエイトも通さず、直接auひかりに申し込みしています）

{% asset_img au.png 1024 alt %}

## 補足

新しいHGWを接続してから、しばらくしてIPv6アドレスが割り当てられていない事に気づきました。結局は翌日の昼頃に特にHGWを再起動したわけでもないですが、IPv6が割り当てられていました。環境変更後、少し時間が掛かるようです。
