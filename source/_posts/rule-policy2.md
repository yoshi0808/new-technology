---
title: XG Firewall v18のOutboundルールを新規作成する
date: 2020-03-14 11:12:50
tags:
  - XG Firewall
categories:
  - Software
---
{% note primary no-icon %}

## Traffic to Wanルールの作成

{% endnote %}

　いよいよ、実際の基本的なルールを作成します。ルールとポリシーのメニューから、「ファイアウォールルールの追加」ボタンを押し、「新しいファイアウォールルール」を選択します。
　ルール名にはここでは「To_Internet」とします。ルールグループは「自動」のままで構いません。アクションは「許可する」のままです。ファイアウォールのログは出力するようにチェックしておきます。現時点で「選択した条件に一致しないため、ルールを既存のグループに追加できません」との表示がありますが、その下のルール設定に進みます。
<!-- more -->

{% asset_img rule1.png alt %}

 　送信元ゾーンには、LANを設定します。今後、VPNを使う方はVPNも加えてください。宛先ゾーンはWANを指定します。その他は変更しません。これを設定した段階で上部に表示されていた注意メッセージが「このルールは自動的にルールグループTraffic to WANに追加されます」という表記に変わります。

　続いて、アプリケーションファイアウォールの設定です。

{% asset_img rule2.png alt %}

　セキュリティの「Webフィルタリング」をクリックし、詳細メニューをオープンします。

- Webポリシーは「Default Policy」を選択します
- 「HTTPおよび復号化したHTTPSをスキャン」をチェックします
- 「FTPのマルウェアをスキャン」をチェックします
- QUICプロトコルのブロックは任意選択です
    Googleのサービスで利用されています。私はチェックしています。Google自体は問題ないですがそのプロトコルを利用した悪質なサイトがFirewallを回避するリスクを減らすという意味で選択しています
- その他のセキュリティ機能でアプリケーションコントロールを選択します
    私は「Block very high risk(Risk Level 5) apps」を選択しています
- IPSは「lantowan_general」を選択します
    保存ボタンをクリックし、ルールの追加が行われます。これでXG Firewall ｖ18の最低限度の設定を終えた事になります

{% note primary no-icon %}

## NATルールの設定

{% endnote %}

　ルールとポリシーのメニューには、ファイアウォールルールとSSL/TLSインスペクションルール、NATに関する「NATルール」設定があります。今回は設定変更しませんが、上記のルールに相当する、「Default SNAT IPv4」というNATルールがあります。これはデフォルトで作成されているもので、LAN側のプライベートIPアドレスからWANへ出ていく時に、グローバルIPへと変換するためのNATの仕組みが記述されています。今回はホームゲートウェイの内側なので、ホームゲートウェイが割り当てたプライベートネットワークアドレスに変換されて、XGのWAN側にパケットが送出されます。XGの基本ですが、ルールは上から順に実行される事になります。従い、デフォルトルールは一番下にあるべきであり、その上に個別のルールを記載していく事になります。
　なお、LinkedNATという機能が提供されています。これは、ファイアウォールルールとNATとを1対1で結びつけるものです。最初から存在しているデフォルトルール、それに加えv17からバージョンアップした際はマイグレーションプロセスによって、ルールとリンクされたNATが1つづつ作成されます。複雑な環境でなければNATのルールは1つで十分です。ルールの1つ1つにNATルールがたくさんあると、NATルールが解りづらくなってしまいます。今回は、OutboundのアクセスについてはLinkedNATの機能の利用は最低限に留め、設定を行っていきます。
