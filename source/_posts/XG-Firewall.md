---
title: XG-Firewall
date: 2020-02-23 09:57:41
tags:
 - XG-Firewall
---

SOPHOS XG Firewall v18の導入

---

## 背景

---

　元々、家庭用の無線ルーターはログも取得出来ないものが多かったり、セキュリティについてはイマイチと考えてる人は多いと思う。そもそも、個人で持っているファイルなんぞ盗られたところで大きな問題になるわけでなし、と大きく構えていた訳だが、ランサムウェア等の脅威が出てきた事で、ファイルを守らないといけなくなってきた。以前よりワンタイムパスワード機能付きのNASである[QNAP](https://www.qnap.com/ja-jp/)を使い、2要素認証を利用しているため、それなりに安心感はあった。が、ITの利便性を求めると、街のWifiからも自宅のリソースに接続したり、家のサーバーを踏み台にしてネットに繋げたいという欲望も出てきて、今度はVPNが欲しいなと思い始めた。

　そもそも、AppleのiCloudあたりに、腹を括って必要なファイルはどーんと置いておけば良いわけだが、これは漏洩よりも万が一のロストが不安。そんなの自宅が火事になってしまう事を考えると、クラウドの方が余程安全と言えるのだが。。。

　という事で、クラウドかオンプレミスか悩んだ末に、オンプレで突き進む事にし、この、[Sophos XG Firewall Home Edition](https://www.sophos.com/ja-jp/products/free-tools.aspx)が無料という事もあって、実は今のバージョンのV18より一つ前のV17からずっと使っている。残念ながら、V18になってから、大幅に機能強化されたのは良かったのだが、設定方法が解りづらくなってしまった。設定を全部投稿するにはどれくらいの時間が掛かるだろうか、空いた時間に書いていても結局書ききるのは数ヶ月先かもしれない。それまでに少しづつ不具合などが改善され、安定しているとちょうど良いのかもしれない。

{% asset_img xg.png %}

---

## 主な機能

---



 　1. Firewall機能（IPフィルタ、Portフィルタ）
  　2. IPS/WAF(WAFは面倒...)
  　3. DDoS対策機能(個人には不要)
  　4. 国別フィルタ(IPv4のみ)
  　5. コンテンツフィルタ（広告などのブロック）
  　6. VPN（2要素認証対応）
  　7. IPv6対応
  　8. DNAT(Destination NAT※いわゆるInbound接続・ポート解放)
  　9. DNS/DHCP(IPv4,IPv6)



---

XG Firewallの導入メリット

---

1. ドメイン単位にWebサイト毎のカテゴリがされているので、ギャンブルやゲーム、アダルトなどのカテゴリで禁止ルールを設定出来る。
2. 接続したくない国に対してアクセス制限が出来る。Outboundはもちろん、自宅にサーバーを建てた場合のInboundで、日本からのみの接続に絞る事も可能(IPv4のみ)。
3. XG本体のルート証明書を端末にインストールする事で、IPS(Intrusion Prevention System)によるhttpsの中身を検査出来る(例えばパスワードが掛かっていないzipファイルをhttpsでダウンロードしてもFirewallで検知出来る)。
4. 広告ブロッカー[280blocker](https://280blocker.net)のリストが取り込め、広告バナーがカットされ、特にスマホのブラウズは快適になる。
5. ログ機能が充実している。
6. VPNにおいてパスワード＋ワンタイムパスワードによる認証が可能(IPSec+X Auth)
7. エラーをフックし、メールでの通知が行われるので安心できる



---

XG Firewallの導入によるデメリット

---

1. 新しいPCが必要(もちろん新品である必要は無いが)。しかも、2枚のネットワークインターフェースが必要。
2. まっさらなDiskにインストールする事になり、バックアップが取れない。従い、VMWare PlayerやvSphere HypervisorまたはMicrosoftのHyper-Vをインストールの上、仮想マシンとして構築すると良い。つまり、相当面倒である。もちろん、物理マシンに直接インストールする事も可能。
3. ネットのパフォーマンスが犠牲になる。特にIPSでhttpsをインターセプトする場合は、速度が犠牲になる。自分はゲームはやらないので分からないが、回線帯域よりもレイテンシ(遅延)が大きくなる事が想定される。
4. 証明書をインストール出来ない家電TVのネット機能などはIPSのhttpsインターセプトは利用出来ない。Androidも証明書はインストール可能だが、アプリ毎にXGのルート証明書を導入する事が求められ実質利用出来ない。※Win,Mac,iOSは利用可能
5. 何よりも、XG Firewallによる保護はエンドポイントの保護を不要にするものではないため、従来通りウィルス対策ソフトはインストールが必要である（と考えている）。

---

と、ここまでデメリットを書いたところで、これを読んだ人は、やる気が無くなるのが普通だと思う。。。