<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/new-technology/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/new-technology/images/icon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/new-technology/images/icon-16x16.png">
  <link rel="mask-icon" href="/new-technology/images/logo.svg" color="#222">

<link rel="stylesheet" href="/new-technology/css/main.css">



<link rel="stylesheet" href="/new-technology/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="/new-technology/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yoshi0808.github.io","root":"/new-technology/","images":"/new-technology/images","scheme":"Mist","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":false,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"検索…","empty":"検索結果が見つかりませんでした: ${query}","hits_time":"${hits} の結果が ${time} ms で見つかりました","hits":"${hits} 件の結果が見つかりました"},"path":"/new-technology/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/new-technology/js/config.js"></script>

    <meta name="description" content="この記事で実現すること  ESXiにおいてネットワークカードの主要ITベンダーであるintelおよびMellanox(NVidia)のファームウェアをアップデートします。sshでESXiホストに接続したままアップデート可能です（作業中は何度かのシステムリスタートが必要になります）。">
<meta property="og:type" content="article">
<meta property="og:title" content="ESXiでネットワークカードのファームウェアを更新する">
<meta property="og:url" content="https://yoshi0808.github.io/new-technology/2022/04/02/nic-firmware/index.html">
<meta property="og:site_name" content="New technologies in our life">
<meta property="og:description" content="この記事で実現すること  ESXiにおいてネットワークカードの主要ITベンダーであるintelおよびMellanox(NVidia)のファームウェアをアップデートします。sshでESXiホストに接続したままアップデート可能です（作業中は何度かのシステムリスタートが必要になります）。">
<meta property="og:locale" content="ja_JP">
<meta property="og:image" content="https://yoshi0808.github.io/new-technology/2022/04/02/nic-firmware/title.png">
<meta property="og:image" content="https://yoshi0808.github.io/new-technology/2022/04/02/nic-firmware/nmst.png">
<meta property="og:image" content="https://yoshi0808.github.io/new-technology/2022/04/02/nic-firmware/mft.png">
<meta property="og:image" content="https://yoshi0808.github.io/new-technology/2022/04/02/nic-firmware/firmware.png">
<meta property="article:published_time" content="2022-04-01T23:10:04.000Z">
<meta property="article:modified_time" content="2023-03-05T22:15:00.000Z">
<meta property="article:author" content="阿部　吉伸(Yoshinobu ABE)">
<meta property="article:tag" content="ESXi">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yoshi0808.github.io/new-technology/2022/04/02/nic-firmware/title.png">


<link rel="canonical" href="https://yoshi0808.github.io/new-technology/2022/04/02/nic-firmware/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"ja","comments":true,"permalink":"https://yoshi0808.github.io/new-technology/2022/04/02/nic-firmware/","path":"2022/04/02/nic-firmware/","title":"ESXiでネットワークカードのファームウェアを更新する"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ESXiでネットワークカードのファームウェアを更新する | New technologies in our life</title>
  



  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{&quot;token&quot;: &quot;0148b4d0442e42b483ddce684030bd2f&quot;}'></script>




<script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JMY6NSC2KK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('consent', 'default', {
  'ad_storage': 'denied',
  'analytics_storage': 'denied'
  });

  dataLayer.push({
  'event': 'default_consent'
  });

  if (Cookies.get('PRVCY202112') == 'Agree') {
    gtag('consent', 'update', {
    'analytics_storage': 'granted'
    });
  }

  gtag('js', new Date());
  gtag('config', 'G-JMY6NSC2KK',{ 'anonymize_ip': true });
</script>


  <noscript>
    <link rel="stylesheet" href="/new-technology/css/noscript.css">
  </noscript>
<link rel="alternate" href="/new-technology/atom.xml" title="New technologies in our life" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="ナビゲーションバーの切り替え" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/new-technology/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">New technologies in our life</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Device,Network,Code,etc...</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="検索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/new-technology/" rel="section"><i class="fa fa-home fa-fw"></i>ホーム</a></li><li class="menu-item menu-item-about"><a href="/new-technology/about/" rel="section"><i class="fa fa-user fa-fw"></i>サイトポリシー</a></li><li class="menu-item menu-item-tags"><a href="/new-technology/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>タグ</a></li><li class="menu-item menu-item-categories"><a href="/new-technology/categories/" rel="section"><i class="fa fa-th fa-fw"></i>カテゴリ</a></li><li class="menu-item menu-item-archives"><a href="/new-technology/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>アーカイブ</a></li><li class="menu-item menu-item-privacy"><a href="/new-technology/privacypolicy/" rel="section"><i class="fa fa-check fa-fw"></i>プライバシーポリシー</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>検索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="検索…" spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          見出し
        </li>
        <li class="sidebar-nav-overview">
          概要
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%AB%E3%83%BC%E3%83%89%E8%87%AA%E4%BD%93%E3%81%AE%E8%84%86%E5%BC%B1%E6%80%A7"><span class="nav-number">1.</span> <span class="nav-text">ネットワークカード自体の脆弱性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%AB%E3%83%BC%E3%83%89-NIC-%E3%81%AE%E4%BF%9D%E5%AE%88%E6%9C%9F%E9%99%90"><span class="nav-number">2.</span> <span class="nav-text">ネットワークカード(NIC)の保守期限</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#intel%E3%81%AE%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E7%B5%82%E4%BA%86NIC"><span class="nav-number">3.</span> <span class="nav-text">intelのサポート終了NIC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Melanox%E3%81%AE%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E7%B5%82%E4%BA%86NIC"><span class="nav-number">4.</span> <span class="nav-text">Melanoxのサポート終了NIC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#intel%E3%81%AENIC%E3%83%95%E3%82%A1%E3%83%BC%E3%83%A0%E3%82%A6%E3%82%A7%E3%82%A2%E6%9B%B4%E6%96%B0"><span class="nav-number">5.</span> <span class="nav-text">intelのNICファームウェア更新</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mellanox%E3%81%AENIC%E3%83%95%E3%82%A1%E3%83%BC%E3%83%A0%E3%82%A6%E3%82%A7%E3%82%A2%E6%9B%B4%E6%96%B0"><span class="nav-number">6.</span> <span class="nav-text">MellanoxのNICファームウェア更新</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%81%BE%E3%81%A8%E3%82%81"><span class="nav-number">7.</span> <span class="nav-text">まとめ</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="阿部　吉伸(Yoshinobu ABE)"
      src="/new-technology/images/yoshi.png">
  <p class="site-author-name" itemprop="name">阿部　吉伸(Yoshinobu ABE)</p>
  <div class="site-description" itemprop="description">IT</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/new-technology/archives/">
          <span class="site-state-item-count">85</span>
          <span class="site-state-item-name">ポスト</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/new-technology/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">カテゴリ</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/new-technology/tags/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">タグ</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/yoshi0808" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yoshi0808" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yoshi0808.blog@gmail.com" title="E-Mail → mailto:yoshi0808.blog@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/yoshi0808_" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;yoshi0808_" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja" class="cc-opacity" rel="noopener" target="_blank"><img src="/new-technology/lib/@creativecommons/vocabulary/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="ja">
    <link itemprop="mainEntityOfPage" href="https://yoshi0808.github.io/new-technology/2022/04/02/nic-firmware/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/new-technology/images/yoshi.png">
      <meta itemprop="name" content="阿部　吉伸(Yoshinobu ABE)">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="New technologies in our life">
      <meta itemprop="description" content="IT">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ESXiでネットワークカードのファームウェアを更新する | New technologies in our life">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ESXiでネットワークカードのファームウェアを更新する
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">投稿日</span>

      <time title="作成日：2022-04-02 08:10:04" itemprop="dateCreated datePublished" datetime="2022-04-02T08:10:04+09:00">2022-04-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">編集日</span>
      <time title="修正日：2023-03-06 07:15:00" itemprop="dateModified" datetime="2023-03-06T07:15:00+09:00">2023-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">カテゴリ</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/new-technology/categories/Hardware/" itemprop="url" rel="index"><span itemprop="name">Hardware</span></a>
        </span>
          、
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/new-technology/categories/Network/" itemprop="url" rel="index"><span itemprop="name">Network</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><img src="/new-technology/2022/04/02/nic-firmware/title.png" class="" width="1024" title="alt">

<p class="onepoint">この記事で実現すること</p>

<p>ESXiにおいてネットワークカードの主要ITベンダーであるintelおよびMellanox(NVidia)のファームウェアをアップデートします。sshでESXiホストに接続したままアップデート可能です（作業中は何度かのシステムリスタートが必要になります）。</p>
<span id="more"></span>

<h2 id="ネットワークカード自体の脆弱性"><a href="#ネットワークカード自体の脆弱性" class="headerlink" title="ネットワークカード自体の脆弱性"></a>ネットワークカード自体の脆弱性</h2><p>（2023-3-5更新）<br>2023-2-14にintelのサイトで700シリーズおよびE810シリーズでCVE-2022-36382の脆弱性について発表がありました。<br>境界外への書き込みでサービス拒否に繋がるとの事（Base Score: 6.0 MEDIUM）です。</p>
<p>その数日後の23-2-17に700シリーズでは新しいv9.2、およびE180シリーズではv4.2のファームウェアが発表されています。</p>
<blockquote>
<p>Intel® Ethernet Controllers and Adapters Advisory<br> <a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00754.html">https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00754.html</a></p>
</blockquote>
<blockquote>
<p>Intel 700 nvmupdate v9.2<br> <a target="_blank" rel="noopener" href="https://www.intel.co.jp/content/www/jp/ja/download/18638/non-volatile-memory-nvm-update-utility-for-intel-ethernet-adapters-700-series-vmware-esx.html?wapkw=nvm%E3%80%80update">https://www.intel.co.jp/content/www/jp/ja/download/18638/non-volatile-memory-nvm-update-utility-for-intel-ethernet-adapters-700-series-vmware-esx.html?wapkw=nvm%E3%80%80update</a></p>
</blockquote>
<blockquote>
<p>Intel E810 nvmupdate v4.2<br> <a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/download/19624/non-volatile-memory-nvm-update-utility-for-intel-ethernet-network-adapter-e810-series.html">https://www.intel.com/content/www/us/en/download/19624/non-volatile-memory-nvm-update-utility-for-intel-ethernet-network-adapter-e810-series.html</a></p>
</blockquote>
<blockquote>
<p>NATIONAL VULNERABILITY DATABASE<br> <a target="_blank" rel="noopener" href="https://nvd.nist.gov/vuln/detail/CVE-2022-36382">https://nvd.nist.gov/vuln/detail/CVE-2022-36382</a></p>
</blockquote>
<p>脆弱性対策情報データベースである、JVN iPdeiaでの検索では、2020年以降、Intel(R) Ethernet I210 Controller、Intel(R) Ethernet 700 Series Controller 、Intel(R) Ethernet Network Controller E810において脆弱性が発見されています。</p>
<ul>
<li>JVN iPdeia （”Intel Ethernet Controller”で検索）<br> <a target="_blank" rel="noopener" href="https://jvndb.jvn.jp/search/index.php?mode=_vulnerability_search_IA_VulnSearch&amp;lang=ja&amp;keyword=Intel+Ethernet+Controller&amp;useSynonym=1&amp;vendor=&amp;product=&amp;datePublicFromYear=&amp;datePublicFromMonth=&amp;datePublicToYear=&amp;datePublicToMonth=&amp;dateLastPublishedFromYear=&amp;dateLastPublishedFromMonth=&amp;dateLastPublishedToYear=&amp;dateLastPublishedToMonth=&amp;cwe=&amp;searchProductId=">https://jvndb.jvn.jp/search/index.php?mode=_vulnerability_search_IA_VulnSearch&amp;lang=ja&amp;keyword=Intel+Ethernet+Controller&amp;useSynonym=1&amp;vendor=&amp;product=&amp;datePublicFromYear=&amp;datePublicFromMonth=&amp;datePublicToYear=&amp;datePublicToMonth=&amp;dateLastPublishedFromYear=&amp;dateLastPublishedFromMonth=&amp;dateLastPublishedToYear=&amp;dateLastPublishedToMonth=&amp;cwe=&amp;searchProductId=</a></li>
</ul>
<p>Mellanox(NVIDIA)のネットワークカードについては脆弱性は見つかっていないようです。</p>
<h2 id="ネットワークカード-NIC-の保守期限"><a href="#ネットワークカード-NIC-の保守期限" class="headerlink" title="ネットワークカード(NIC)の保守期限"></a>ネットワークカード(NIC)の保守期限</h2><p>ESXiでのドライバはintelやMellanoxを使っている限りは最適なドライバがパッチ公開のタイミングで提供されます。但し、チップを動作させるネットワークカード上のファームウェアは別途NICの提供ベンダーからのパッチを適用する必要があります。<br>ESXiのハードウェア互換リストでは古いネットワークカードでも対応している場合があります。しかし、ベンダー側でサポート終了（EOSL）となっている製品もあり注意が必要です。ビジネス用途でなければ使えるうちは使うといった対応が取れますが、万が一ファームウェアで脆弱性などが指摘された場合は、そのNICの利用を取りやめる必要が出てきます。</p>
<h2 id="intelのサポート終了NIC"><a href="#intelのサポート終了NIC" class="headerlink" title="intelのサポート終了NIC"></a>intelのサポート終了NIC</h2><p>以下のリンクではintelの製造終了のNIC一覧情報があります。さらに5年経過でサポート終了という事です。X520やX540なども製造終了しており、5年間の保証ポリシーの対象となっています。</p>
<ul>
<li>intel<br> <a target="_blank" rel="noopener" href="https://www.intel.co.jp/content/www/jp/ja/support/articles/000026530/ethernet-products/legacy-ethernet-products.html">https://www.intel.co.jp/content/www/jp/ja/support/articles/000026530/ethernet-products/legacy-ethernet-products.html</a></li>
</ul>
<p>しかし、X520とX540の新しいファームウェアのダウンロードについては見つかりませんでした。私の見落としでなければ、最新版のファームウェアの提示が無いというのはこれから新規導入する場合、リスクが大きく感じます。</p>
<h2 id="Melanoxのサポート終了NIC"><a href="#Melanoxのサポート終了NIC" class="headerlink" title="Melanoxのサポート終了NIC"></a>Melanoxのサポート終了NIC</h2><p>Mellanoxにおいても”Products End-of-Life Policy”というものがあり、販売終了から5年経過し、End of Supportとなるようです。<br>以前にはEOSの製品一覧が記載されているExcelファイルが置いてあったんですが、最近は無くなってしまいました。</p>
<p>最近は$40で購入できるMCX311A-XCATなどは2020年3月31日に販売終了となっています。<br>Mellanoxの場合はVMwareの互換リストから外れているConnect X-3についてもWebにはファームウェアの情報が掲載されているので、いつでも最新のファームウェアに更新できます。</p>
<h2 id="intelのNICファームウェア更新"><a href="#intelのNICファームウェア更新" class="headerlink" title="intelのNICファームウェア更新"></a>intelのNICファームウェア更新</h2><p>intelの純正のNICであればそのカード名称でintelのサイトを検索しファームウェアを更新します。また、3rdベンダーがintelチップを採用し製造したNICだとintelのチップの名称でファームウェアをダウンロードする必要があります。「<a href="/new-technology/2022/02/27/building-setup-esxi7/" title="ESXI7.0をRyzen7 5700Gで構築">ESXI7.0をRyzen7 5700Gで構築</a>」では、私は3rdベンダーが製造したintel X710を搭載したNICを購入したと書きましたが、このようなケースではintelが提供するファームウェアを適用可能なのか、それとも3rdベンダーが提供するファームウェアがあるのか事前に確認する必要があります。X710のSFP＋を4Portというのは低消費電力・低発熱で魅力的ですが、前述した脆弱性について既に確認していたため、ファームウェアのアップデートに言及できるベンダーのものを選定しました。販売者の中には「できるはずだがお勧めしない」という回答もありました。3rdベンダーの場合は、ファームウェアアップデートの設定ファイルの書き換えが必要な場合もあります（私の購入したNICはこの修正が不要でした）。</p>
<p>導入はシンプルでnvmupdateというファームウェア更新ツールとセットになったNICのファームウェアをintelのサイトからダウンロードし、ESXiにSSHで接続し実行するだけです。留意点としては、誤った種類のファームウェア適用によりNICが使えなくなってしまった場合は自己責任であり、リスクはあります。</p>
<p>導入手順を説明します。intelのサイトで”nvm update”を検索します。するとX550シリーズ、700シリーズ、E810シリーズとnvmupdateについて表示されるのでお使いのチップに相当するモジュールをダウンロードしてください。intel純正のカードであればカード名で検索も可能です。</p>
<ul>
<li><p>X550シリーズ<br> <a target="_blank" rel="noopener" href="https://www.intel.co.jp/content/www/jp/ja/download/19362/non-volatile-memory-nvm-update-utility-for-intel-ethernet-adapters-550-series-vmware-esx.html?wapkw=nvm%20update%20esxi">https://www.intel.co.jp/content/www/jp/ja/download/19362/non-volatile-memory-nvm-update-utility-for-intel-ethernet-adapters-550-series-vmware-esx.html?wapkw=nvm%20update%20esxi</a></p>
</li>
<li><p>700シリーズ<br> <a target="_blank" rel="noopener" href="https://www.intel.co.jp/content/www/jp/ja/download/18638/non-volatile-memory-nvm-update-utility-for-intel-ethernet-adapters-700-series-vmware-esx.html?wapkw=nvm%E3%80%80update">https://www.intel.co.jp/content/www/jp/ja/download/18638/non-volatile-memory-nvm-update-utility-for-intel-ethernet-adapters-700-series-vmware-esx.html?wapkw=nvm%E3%80%80update</a></p>
</li>
<li><p>E810シリーズ<br> <a target="_blank" rel="noopener" href="https://www.intel.co.jp/content/www/jp/ja/download/19628/non-volatile-memory-nvm-update-utility-for-intel-ethernet-network-adapters-e810-series-vmware-esx.html?wapkw=e810%20nvm%20update">https://www.intel.co.jp/content/www/jp/ja/download/19628/non-volatile-memory-nvm-update-utility-for-intel-ethernet-network-adapters-e810-series-vmware-esx.html?wapkw=e810%20nvm%20update</a></p>
</li>
</ul>
<p>それぞれのダウンロードページには、クイック使用ガイドというものがありますのでそこに詳細な手順が記されています。</p>
<p> <a target="_blank" rel="noopener" href="https://www.intel.co.jp/content/www/jp/ja/embedded/products/networking/nvm-update-tool-vmware-esx-quick-usage-guide.html">https://www.intel.co.jp/content/www/jp/ja/embedded/products/networking/nvm-update-tool-vmware-esx-quick-usage-guide.html</a></p>
<p>700シリーズのファームウェア適用の実例です。まずNICのFirmwareを確認します。対象のNIC（vmnicx）を指定し内容を確認します。<code>esxcli network nic get -n [物理NICのID]</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi2:~] esxcli network nic get -n vmnic0</span><br><span class="line">   Advertised Auto Negotiation: true</span><br><span class="line">   Advertised Link Modes: Auto, 10000BaseT/Full</span><br><span class="line">   Auto Negotiation: true</span><br><span class="line">   Cable Type: DA</span><br><span class="line">   Current Message Level: 1</span><br><span class="line">   Driver Info:</span><br><span class="line">         Bus Info: 0000:01:00:0</span><br><span class="line">         Driver: i40en</span><br><span class="line">         Firmware Version: 8.50 0x8000b6c5 1.2074.0</span><br><span class="line">         Version: 1.11.1.31</span><br><span class="line">   Link Detected: true</span><br><span class="line">   Link Status: Up</span><br><span class="line">   Name: vmnic0</span><br><span class="line">   PHYAddress: 0</span><br><span class="line">   Pause Autonegotiate: false</span><br><span class="line">   Pause RX: true</span><br><span class="line">   Pause TX: true</span><br><span class="line">   Supported Ports: DA</span><br><span class="line">   Supports Auto Negotiation: true</span><br><span class="line">   Supports Pause: true</span><br><span class="line">   Supports Wakeon: true</span><br><span class="line">   Transceiver:</span><br><span class="line">   Virtual Address: 00:00:00:00:00:00</span><br><span class="line">   Wakeon: MagicPacket(tm)</span><br></pre></td></tr></table></figure>
<p>続いてダウンロードしたファイル（700シリーズは2023年3月5日時点では最新がv9.2です）をscpかストアブラウザを使ってESXi上にアップロードします。その後展開し実行します。<br>特に注意点はありませんが、私は実行にあたりメンテナンスモードにして（VMを停止）から開始しました（アップデート中に、仮想マシンが止まるようなことはありませんが）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi2:] tar -xvf 700Series_NVMUpdatePackage_v9_20_ESX.tar.gz</span><br><span class="line">#展開されたフォルダに入り以下を実行します。</span><br><span class="line">[root@esxi2:] ./nvmupdaten64e</span><br></pre></td></tr></table></figure>

<p>以下ではNICを全て対象、NVMイメージのバックアップは有りということで実行したログになります。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Intel(R) Ethernet NVM Update Tool</span><br><span class="line">NVMUpdate version 1.39.32.6</span><br><span class="line">Copyright(C) 2013 - 2023 Intel Corporation.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">WARNING: To avoid damage to your device, do not stop the update or reboot or power off the system during this update.</span><br><span class="line">Inventory in progress. Please wait [****......]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Num Description                          Ver.(hex)  DevId S:B    Status</span><br><span class="line">=== ================================== ============ ===== ====== ==============</span><br><span class="line">01) Intel(R) Ethernet Controller X710  8.112(8.70)   1572 00:001 Update</span><br><span class="line">    for 10GbE SFP+                                               available</span><br><span class="line"></span><br><span class="line">Options: Adapter Index List (comma-separated), [A]ll, e[X]it</span><br><span class="line">Enter selection: A</span><br><span class="line">Would you like to back up the NVM images? [Y]es/[N]o: Y</span><br><span class="line">Update in progress. This operation may take several minutes.</span><br><span class="line">[....|*****]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Num Description                          Ver.(hex)  DevId S:B    Status</span><br><span class="line">=== ================================== ============ ===== ====== ==============</span><br><span class="line">01) Intel(R) Ethernet Controller X710   9.32(9.20)   1572 00:001 Update</span><br><span class="line">    for 10GbE SFP+                                               successful</span><br><span class="line"></span><br><span class="line">Reboot is required to complete the update process.</span><br><span class="line"></span><br><span class="line">Tool execution completed with the following status: All operations completed successfully.</span><br><span class="line">Press any key to exit.</span><br><span class="line"></span><br><span class="line">[root@esxi2:~] reboot</span><br></pre></td></tr></table></figure>
<p>最後にリブートが必要とのことでリブートしています。</p>
<p>ホストが再起動後、ファームウェアが適用されているか再び確認します。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi2:~] esxcli network nic get -n vmnic0</span><br><span class="line">   Advertised Auto Negotiation: true</span><br><span class="line">   Advertised Link Modes: Auto, 10000BaseT/Full</span><br><span class="line">   Auto Negotiation: true</span><br><span class="line">   Cable Type: DA</span><br><span class="line">   Current Message Level: 1</span><br><span class="line">   Driver Info:</span><br><span class="line">         Bus Info: 0000:01:00:0</span><br><span class="line">         Driver: i40en</span><br><span class="line">         Firmware Version: 9.20 0x8000d8bc 1.2074.0</span><br><span class="line">         Version: 1.11.1.31</span><br><span class="line">   Link Detected: true</span><br><span class="line">   Link Status: Up</span><br><span class="line">   Name: vmnic0</span><br><span class="line">   PHYAddress: 0</span><br><span class="line">   Pause Autonegotiate: false</span><br><span class="line">   Pause RX: true</span><br><span class="line">   Pause TX: true</span><br><span class="line">   Supported Ports: DA</span><br><span class="line">   Supports Auto Negotiation: true</span><br><span class="line">   Supports Pause: true</span><br><span class="line">   Supports Wakeon: true</span><br><span class="line">   Transceiver:</span><br><span class="line">   Virtual Address: 00:00:00:00:00:00</span><br><span class="line">   Wakeon: MagicPacket(tm)</span><br></pre></td></tr></table></figure>

<p><code>Firmware Version: 9.20</code>ということで、無事更新されました。</p>
<p>intelの手順書では、NOTEとして、以下の説明があります。</p>
<blockquote>
<p>On 700 Series and 500 Series devices, updating to the most current NVM (with the NVM Update Package) and driver does not update the Option ROM. Intel recommends an Option ROM update after the NVM and driver are updated. Refer to the User Guide for Intel® Ethernet Adapters page for the most current Option ROM update process version.</p>
</blockquote>
<p>これはネットワークブート時の<mark class="label primary">UEFI Network Driver Option ROM</mark>をLinuxまたはUEFIシェルを使ってUEFIネットワークドライバを更新するものです。今回はこの作業については割愛します。</p>
<h2 id="MellanoxのNICファームウェア更新"><a href="#MellanoxのNICファームウェア更新" class="headerlink" title="MellanoxのNICファームウェア更新"></a>MellanoxのNICファームウェア更新</h2><p>Mellanoxの場合は、NVIDIAのサイトに”How-to: Install NVIDIA Firmware Tools (MFT) on VMware ESXi 6.7&#x2F;7.0.”というマニュアルがありますので、そこで手順を確認します。</p>
<blockquote>
<p>How-to: Install NVIDIA Firmware Tools (MFT) on VMware ESXi 6.7&#x2F;7.0.<br> <a target="_blank" rel="noopener" href="https://docs.nvidia.com/networking/pages/releaseview.action?pageId=15049813">https://docs.nvidia.com/networking/pages/releaseview.action?pageId=15049813</a></p>
</blockquote>
<p>NVIDIA Firmware Toolをダウンロードし、ESXiにインストールします。その後別途ファームウェアをダウンロードしてファームウェアのアップグレードを行います。昔はflintでしたが、上記手順によれば今はmlxfwmanagerというのが使われるようです。Windowsではそのサブセットのmlxupが一般的です。</p>
<ol>
<li><p>ツールを2つダウンロードするために、ダウンロードページにアクセスします。<br> <a target="_blank" rel="noopener" href="http://www.mellanox.com/page/management_tools">http://www.mellanox.com/page/management_tools</a></p>
</li>
<li><p>ここの例ではESXi7.0向けのVersion4.18.1を使い進めます。</p>
</li>
<li><p>“7 Native”、”x64”を選択し、”Mellanox-NATIVE-NMST_4.18.1.14-1OEM.700.1.0.15843807_19206114-package.zip”をダウンロードし展開します。</p>
</li>
<li><p>ZIPの中にはさらにZIPファイルがあり、”MEL_bootbank_nmst_4.18.1.14-1OEM.700.1.0.15843807.vib”というESXiのモジュールファイルを見つけます。 <img src="/new-technology/2022/04/02/nic-firmware/nmst.png" class="" width="480" title="alt"></p>
</li>
<li><p>続いて、”Mellanox-MFT-Tools_4.18.1.14-1OEM.700.1.0.15843807_19206112-package.zip”をダウンロードし展開します。</p>
</li>
<li><p>こちらもZIPの中にさらにZIPファイルがあり、”mft”というフォルダの中に”MEL_bootbank_mft_4.18.1.14-0.vib”のモジュールファイルを見つけます。別にOEMというフォルダがあり、NVIDIAの手順書でもファイル名からもOEMを選ぶべきのように見えますが、OEMのフォルダのものは必要なモジュールが見つかりません。<img src="/new-technology/2022/04/02/nic-firmware/mft.png" class="" width="480" title="alt"></p>
</li>
<li><p>scpかストアブラウザを使いこの2つのファイルをESXiにアップロードします。2つのモジュールは1つづつインストール、リブートが必要になりますので、&#x2F;tmpにコピーする場合は最初のリブートで&#x2F;tmpがクリアされるのでお気をつけください。</p>
</li>
<li><p>ESXiにSSHで接続し、最初のモジュール(NMST)をインストールします。<code>esxcli software vib install -v /tmp/MEL_bootbank_nmst_4.18.1.14-1OEM.700.1.0.15843807.vib -f</code></p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost:/tmp] esxcli software vib install -v /tmp/MEL_bootbank_nmst_4.18.1.14-1OEM.700.1.0.15843807.vib -f</span><br><span class="line">Installation Result</span><br><span class="line">   Message: The update completed successfully, but the system needs to be rebooted <span class="keyword">for</span> the changes to be effective.</span><br><span class="line">   Reboot Required: <span class="literal">true</span></span><br><span class="line">   VIBs Installed: MEL_bootbank_nmst_4.18.1.14-1OEM.700.1.0.15843807</span><br><span class="line">   VIBs Removed:</span><br><span class="line">   VIBs Skipped:</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>ここで一旦リブートします。</p>
</li>
<li><p>SSHで接続後、2つ目のモジュール(MFT-Tools)をインストールします。<code>esxcli software vib install -v /tmp/MEL_bootbank_mft_4.18.1.14-0.vib -f</code></p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> [root@localhost:/tmp] esxcli software vib install -v /tmp/MEL_bootbank_mft_4.18.1.14-0.vib -f</span><br><span class="line">Installation Result</span><br><span class="line">   Message: The update completed successfully, but the system needs to be rebooted for the changes to be effective.</span><br><span class="line">   Reboot Required: true</span><br><span class="line">   VIBs Installed: MEL_bootbank_mft_4.18.1.14-0</span><br><span class="line">   VIBs Removed:</span><br><span class="line">   VIBs Skipped:</span><br></pre></td></tr></table></figure></li>
<li><p>再びリブートします。</p>
</li>
<li><p>ESXiにインストールされているモジュールを確認します。<code>esxcli software vib list</code><br> 先頭に以下のモジュールがあるはずです。PartnerSupportedとなっており、セキュアブートのESXiでも問題ありません。</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> Name                           Version                                Vendor  Acceptance Level  Install Date</span><br><span class="line">-----------------------------  -------------------------------------  ------  ----------------  ------------</span><br><span class="line">mft                            4.18.1.14-0                            MEL     PartnerSupported  2022-03-13</span><br><span class="line">nmst                           4.18.1.14-1OEM.700.1.0.15843807        MEL     PartnerSupported  2022-03-13</span><br></pre></td></tr></table></figure></li>
<li><p>SSHで接続後、ツールの動作確認をします。ここではConnectX3がある環境です。<code>cd /opt/mellanox/bin</code>,<code>./mst start</code>,<code>./mst status</code>,<code>./mst status -vv</code></p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost:/opt/mellanox/bin] ./mst start</span><br><span class="line">Module mst is already loaded</span><br><span class="line">[root@localhost:/opt/mellanox/bin] ./mst status</span><br><span class="line">MST devices:</span><br><span class="line">------------</span><br><span class="line">mt4099_pciconf0</span><br><span class="line">mt4099_pci_cr0</span><br><span class="line"></span><br><span class="line">[root@localhost:/opt/mellanox/bin] /opt/mellanox/bin/mst status -vv</span><br><span class="line">PCI devices:</span><br><span class="line">------------</span><br><span class="line">DEVICE_TYPE             MST                           PCI       RDMA            NET                       NUMA</span><br><span class="line">ConnectX3(rev:1)        mt4099_pciconf0               01:00.0   net-vmnic0</span><br><span class="line">ConnectX3(rev:1)        mt4099_pci_cr0                01:00.0   net-vmnic0</span><br></pre></td></tr></table></figure></li>
<li><p>ファームウェアアップデートに使うmlxfwmanagerの動作確認をします。<code>./mlxfwmanager --query</code></p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost:/opt/mellanox/bin] ./mlxfwmanager --query</span><br><span class="line">Querying Mellanox devices firmware ...</span><br><span class="line"></span><br><span class="line">Device #1:</span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line"> Device Type:      ConnectX3</span><br><span class="line"> Part Number:      MCX311A-XCA_Ax</span><br><span class="line"> Description:      ConnectX-3 EN network interface card; 10GigE; single-port SFP+; PCIe3.0 x4 8GT/s; RoHS R6</span><br><span class="line"> PSID:             MT_1170110023</span><br><span class="line"> PCI Device Name:  mt4099_pci_cr0</span><br><span class="line"> Port1 MAC:        0002c9xxxxxx</span><br><span class="line"> Port2 MAC:        0002c9xxxxxx</span><br><span class="line"> Versions:         Current        Available</span><br><span class="line">    FW             2.33.5220      N/A</span><br><span class="line">    PXE            3.4.0467       N/A</span><br><span class="line"></span><br><span class="line"> Status:           No matching image found</span><br></pre></td></tr></table></figure>
<p> 今回のケースでは、ebayにて＄50で購入可能な、ConnectX-3（MCX311A-XCAT）を対象としています。</p>
</li>
<li><p>NVIDIAのサイトからファームウェアをダウンロードします。<br>　<a target="_blank" rel="noopener" href="https://network.nvidia.com/support/firmware/firmware-downloads/">https://network.nvidia.com/support/firmware/firmware-downloads/</a></p>
</li>
<li><p>該当するEthernetファームウェアを選択し、ZIPファイルをダウンロードし展開します。*.binというファイルが抽出されます。</p>
 <img src="/new-technology/2022/04/02/nic-firmware/firmware.png" class="" width="480" title="alt">
</li>
<li><p>scpまたはストアブラウザでbinファイルをESXiの&#x2F;tmpにアップロードします。</p>
</li>
<li><p>ファームウェアのアップデートを行います <code>./mlxfwmanager -u -i /tmp/ファームウェア.bin</code>。ファームウェアの実行直前に確認が求められるので、”y”を入力します。</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost:/opt/mellanox/bin] ./mlxfwmanager -u -i /tmp/fw-ConnectX3-rel-2_42_5000-MCX311A-XCA_Ax-FlexBoot-3.4.752.bin</span><br><span class="line">Querying Mellanox devices firmware ...</span><br><span class="line"></span><br><span class="line">Device #1:</span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line"> Device Type:      ConnectX3</span><br><span class="line"> Part Number:      MCX311A-XCA_Ax</span><br><span class="line"> Description:      ConnectX-3 EN network interface card; 10GigE; single-port SFP+; PCIe3.0 x4 8GT/s; RoHS R6</span><br><span class="line"> PSID:             MT_1170110023</span><br><span class="line"> PCI Device Name:  mt4099_pci_cr0</span><br><span class="line"> Port1 MAC:        0002c9232da0</span><br><span class="line"> Port2 MAC:        0002c9232da1</span><br><span class="line"> Versions:         Current        Available</span><br><span class="line">    FW             2.33.5220      2.42.5000</span><br><span class="line">    PXE            3.4.0467       3.4.0752</span><br><span class="line"></span><br><span class="line"> Status:           Update required</span><br><span class="line"></span><br><span class="line">---------</span><br><span class="line">Found 1 device(s) requiring firmware update...</span><br><span class="line"></span><br><span class="line">Perform FW update? [y/N]: y</span><br><span class="line">Device #1: Updating FW ...</span><br><span class="line">Done</span><br><span class="line"></span><br><span class="line">Restart needed for updates to take effect.</span><br></pre></td></tr></table></figure></li>
<li><p>リブートします。</p>
</li>
<li><p>再び、<code>./mlxfwmanager --query</code>を実行し、ファームウェアがアップデートされたか確認します。</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost:/opt/mellanox/bin]  ./mlxfwmanager --query</span><br><span class="line">Querying Mellanox devices firmware ...</span><br><span class="line"></span><br><span class="line">Device #1:</span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line"> Device Type:      ConnectX3</span><br><span class="line"> Part Number:      MCX311A-XCA_Ax</span><br><span class="line"> Description:      ConnectX-3 EN network interface card; 10GigE; single-port SFP+; PCIe3.0 x4 8GT/s; RoHS R6</span><br><span class="line"> PSID:             MT_1170110023</span><br><span class="line"> PCI Device Name:  mt4099_pci_cr0</span><br><span class="line"> Port1 MAC:        0002c9xxxxxx</span><br><span class="line"> Port2 MAC:        0002c9xxxxxx</span><br><span class="line"> Versions:         Current        Available</span><br><span class="line">    FW             2.42.5000      N/A</span><br><span class="line">    PXE            3.4.0752       N/A</span><br><span class="line"></span><br><span class="line"> Status:           No matching image found</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>intelでは新しいファームウェアについて推奨と書かれる場合があり判断が難しいケースがありますが、脆弱性や製品の組み合わせなど問題が顕在化する環境に当てはまる場合のみ、新しいファームウェアを適用すべきでしょうか。ファームウェアとドライバーとの整合性もあるのでリリースノートを参照されることをお勧めします。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/new-technology/tags/ESXi/" rel="tag"><i class="fa fa-tag"></i> ESXi</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/new-technology/2022/03/25/xg-v185-mr3/" rel="prev" title="Sophos Firewall v18.5 MR-3">
                  <i class="fa fa-angle-left"></i> Sophos Firewall v18.5 MR-3
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/new-technology/2022/04/29/xg-v19/" rel="next" title="Sophos Firewall v19">
                  Sophos Firewall v19 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2020 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">阿部　吉伸(Yoshinobu ABE)</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div><script src="https://cdn.jsdelivr.net/npm/simple-gdpr@1.1.5/dist/simplegdpr.umd.js"></script>
<link href="https://cdn.jsdelivr.net/npm/simple-gdpr@1.1.5/dist/simplegdpr.min.css" rel="stylesheet">

<script>
if (Cookies.get('PRVCY202112') != 'Agree') {
  const notice = new SimpleGDPR({
    title: 'Accept Cookies & Privacy Policy?',
    message: 'このWebサイトでは、訪問や活動に関するデータがクッキー等によって収集されます。閲覧を継続される場合、\
    プライバシーポリシーをご覧いただき同意(Agree)をお願いします',
    link: null,
    icons: true,
    theme: 'light',
    animation: 'fade',
    float: 'bottom-right',
      callback: () => {
      notice.close();
      Cookies.set('PRVCY202112', 'Agree', { expires: 365, path: '/'});
      notice.destroy();
      // Google Analytics 4
      gtag('consent', 'update', {
      'analytics_storage': 'granted'
      });
      gtag('js', new Date());
      gtag('config', 'G-JMY6NSC2KK', { 'anonymize_ip': true });
      },
  });
}
</script>
<div class="disclaimer1">
このサイトの記事は、特別な記載がない限り <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja">クリエイティブ・コモンズ BY-NC-SA ライセンス</a>で保護されています</div>



    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/yoshi0808" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="/new-technology/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="/new-technology/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
<script src="/new-technology/js/comments.js"></script><script src="/new-technology/js/utils.js"></script><script src="/new-technology/js/motion.js"></script><script src="/new-technology/js/schemes/muse.js"></script><script src="/new-technology/js/next-boot.js"></script>

  <script src="/new-technology/lib/hexo-generator-searchdb/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/new-technology/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/new-technology/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-mm3Re3y7xlvh+yCD+l/Zs1d+PU0AEad93MkWvljfm/s="}}</script>
  <script src="/new-technology/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
